<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>虚拟化KVM-原理部署 | 一往无前虎山行,拨开云雾见光明</title><meta name="author" content="赵东兴"><meta name="copyright" content="赵东兴"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="虚拟化原理什么是虚拟化虚拟化是一种技术，它利用软件或硬件创建虚拟的版本或环境，使得一个物理资源（如服务器、存储设备、网络等）可以被划分成多个独立的虚拟资源。这些虚拟资源可以独立运行不同的操作系统、应用程序或服务，从而提高资源利用率、灵活性和可靠性。虚拟化技术包括服务器虚拟化、网络虚拟化、存储虚拟化和桌面虚拟化等。虚拟化技术被广泛应用于数据中心、云计算、虚拟化服务器、虚拟桌面和软件定义网络等领域。">
<meta property="og:type" content="article">
<meta property="og:title" content="虚拟化KVM-原理部署">
<meta property="og:url" content="http://example.com/2024/08/20/%E8%99%9A%E6%8B%9F%E5%8C%96KVM-%E5%8E%9F%E7%90%86%E9%83%A8%E7%BD%B2/index.html">
<meta property="og:site_name" content="一往无前虎山行,拨开云雾见光明">
<meta property="og:description" content="虚拟化原理什么是虚拟化虚拟化是一种技术，它利用软件或硬件创建虚拟的版本或环境，使得一个物理资源（如服务器、存储设备、网络等）可以被划分成多个独立的虚拟资源。这些虚拟资源可以独立运行不同的操作系统、应用程序或服务，从而提高资源利用率、灵活性和可靠性。虚拟化技术包括服务器虚拟化、网络虚拟化、存储虚拟化和桌面虚拟化等。虚拟化技术被广泛应用于数据中心、云计算、虚拟化服务器、虚拟桌面和软件定义网络等领域。">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-08-20T03:23:29.000Z">
<meta property="article:modified_time" content="2024-08-20T03:37:15.623Z">
<meta property="article:author" content="赵东兴">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/08/20/%E8%99%9A%E6%8B%9F%E5%8C%96KVM-%E5%8E%9F%E7%90%86%E9%83%A8%E7%BD%B2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '虚拟化KVM-原理部署',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-20 11:37:15'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="一往无前虎山行,拨开云雾见光明" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="一往无前虎山行,拨开云雾见光明"><span class="site-name">一往无前虎山行,拨开云雾见光明</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">虚拟化KVM-原理部署</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-20T03:23:29.000Z" title="Created 2024-08-20 11:23:29">2024-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-08-20T03:37:15.623Z" title="Updated 2024-08-20 11:37:15">2024-08-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="虚拟化KVM-原理部署"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="虚拟化原理"><a href="#虚拟化原理" class="headerlink" title="虚拟化原理"></a>虚拟化原理</h1><h2 id="什么是虚拟化"><a href="#什么是虚拟化" class="headerlink" title="什么是虚拟化"></a>什么是虚拟化</h2><p>虚拟化是一种技术，它利用软件或硬件创建虚拟的版本或环境，使得一个物理资源（如服务器、存储设备、网络等）可以被划分成多个独立的虚拟资源。这些虚拟资源可以独立运行不同的操作系统、应用程序或服务，从而提高资源利用率、灵活性和可靠性。虚拟化技术包括服务器虚拟化、网络虚拟化、存储虚拟化和桌面虚拟化等。虚拟化技术被广泛应用于数据中心、云计算、虚拟化服务器、虚拟桌面和软件定义网络等领域。</p>
<h2 id="虚拟化分类"><a href="#虚拟化分类" class="headerlink" title="虚拟化分类"></a>虚拟化分类</h2><p>虚拟化可以分为多种类型，包括以下几种主要分类：</p>
<ol>
<li>服务器虚拟化：将一台物理服务器划分成多个虚拟服务器，每个虚拟服务器可以独立运行不同的操作系统和应用程序。</li>
<li>网络虚拟化：通过软件定义网络（SDN）技术，实现网络资源的虚拟化，使得网络资源可以按需分配和管理。</li>
<li>存储虚拟化：将多个物理存储设备整合成一个虚拟存储池，实现存储资源的统一管理和分配。</li>
<li>桌面虚拟化：将用户的桌面环境（包括操作系统和应用程序）虚拟化到服务器端，用户可以通过终端设备远程访问虚拟桌面。</li>
<li>应用程序虚拟化：将应用程序与其依赖的运行时环境打包成一个独立的容器，实现应用程序的独立部署和运行。</li>
<li>数据虚拟化：将分布在不同数据源中的数据抽象为统一的虚拟数据层，使得用户可以通过统一的接口来访问和管理数据。</li>
</ol>
<p>这些虚拟化技术可以根据不同的应用场景和需求，灵活地组合和应用，以提高资源利用率、灵活性和可靠性。</p>
<h2 id="服务器虚拟化"><a href="#服务器虚拟化" class="headerlink" title="服务器虚拟化"></a>服务器虚拟化</h2><blockquote>
<p>要学习的就是服务器虚拟化</p>
</blockquote>
<p><strong>使用服务器虚拟化的主要原因包括提高资源利用率、‌降低成本、‌提高灵活性和可扩展性、‌提高可用性和灾难恢复能力、‌支持测试和开发，‌以及简化管理和维护工作。‌</strong></p>
<ul>
<li><strong>提高资源利用率</strong>：‌通过将物理服务器的资源（‌如CPU、‌内存、‌存储等）‌分配给多个虚拟服务器，‌可以显著提高资源的利用率。‌在没有虚拟化的情况下，‌如果一台服务器的资源没有被完全使用，‌那么这些资源就会被浪费。‌虚拟化技术使得企业能够更加高效地使用其硬件资源1。‌</li>
<li><strong>降低成本</strong>：‌通过减少需要的物理服务器的数量，‌虚拟化技术可以降低硬件、‌电力、‌冷却和维护的成本。‌由于虚拟化可以提高资源的利用率，‌因此也可以降低软件许可的成本。‌此外，‌通过减少数据中心里服务器和相关硬件的数量，‌企业可以从减少机房空间、‌能耗与制冷需求中获益，‌从而降低IT成本2。‌</li>
<li><strong>提高灵活性和可扩展性</strong>：‌虚拟化使得IT管理员可以快速地添加、‌删除或移动虚拟机，‌以满足业务需求的变化。‌这比在物理服务器上进行操作要快得多，‌也更容易。‌这种灵活性有助于企业快速适应不断变化的市场需求1。‌</li>
<li><strong>提高可用性和灾难恢复能力</strong>：‌通过虚拟化，‌可以更容易地实现高可用性和灾难恢复。‌如果一台物理服务器失败，‌那么在其上运行的所有虚拟机都会受到影响。‌通过使用虚拟化技术，‌可以将这些虚拟机快速地迁移到其他物理服务器上，‌从而减少停机时间1。‌</li>
<li><strong>支持测试和开发</strong>：‌虚拟化可以创建独立的环境供开发和测试使用，‌这可以避免干扰生产环境，‌同时也可以更快地配置和拆除这些环境。‌这对于需要频繁进行环境变更的测试和开发团队来说尤为重要1。‌</li>
<li><strong>简化管理和维护工作</strong>：‌通过集中管理工具，‌企业能够更好地监控和管理虚拟化环境，‌简化了管理和维护工作，‌提高了效率。‌服务器虚拟化技术通过备份、‌迁移和快速恢复等功能提高了系统的可靠性和容错能力，‌保障业务连续性。‌</li>
</ul>
<h2 id="服务器虚拟化好处"><a href="#服务器虚拟化好处" class="headerlink" title="服务器虚拟化好处"></a>服务器虚拟化好处</h2><p><strong>‌<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96&usm=4&ie=utf-8&rsv_pq=937d99dc00151187&oq=%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E5%A5%BD%E5%A4%84&rsv_t=1372JbfDFccm8bTyQ+Ujbq68CsMHgcNHMZNR06GlEzIb34KU4vs8MnauAqU&sa=re_dqa_zy">服务器虚拟化</a>的好处</strong>主要包括：‌12</p>
<ol>
<li><strong>降低成本</strong>：通过虚拟化技术，可以在一台物理服务器上运行多个虚拟机，从而节省硬件成本。此外，虚拟化技术可以减少对硬件的需求，包括电力、维护、冷却和物理硬件占用面积等，进一步降低总体拥有成本。</li>
<li><strong>提高资源利用率</strong>：虚拟化技术可以将物理服务器上的资源进行分割，每个虚拟机可以独立分配资源，从而提高资源利用率。这种资源池化模式允许企业根据实际需求动态分配资源，减少资源浪费。</li>
<li><strong>简化管理</strong>：通过虚拟化技术，可以将多个虚拟机集中管理，减少管理员的工作量。集中管理应用程序可以根据需要监控和调整所有虚拟服务器的状态，从而节省时间和金钱。</li>
<li><strong>提高可靠性</strong>：虚拟化技术可以提高服务器的可靠性，因为虚拟机之间是隔离的，一个虚拟机出现问题不会影响其他虚拟机的运行。此外，快照功能有助于实现即时的虚拟机恢复。</li>
<li><strong>快速部署</strong>：虚拟化技术可以快速地部署新的虚拟机，从而快速响应业务需求。这减少了物理服务器的部署时间，加快了工作负载部署速度。</li>
<li><strong>高灵活性</strong>：虚拟化技术可以根据业务需求进行灵活的资源分配和调整，从而满足不同的业务需求。这种灵活性支持异构操作系统的整合和老应用的持续运行，减少迁移成本。</li>
<li><strong>提高安全性</strong>：虚拟化技术可以提高服务器的安全性，因为虚拟机之间是隔离的，一个虚拟机被攻击不会影响其他虚拟机的安全。这有助于保护企业数据免受威胁。</li>
<li><strong>环保高效</strong>：通过服务器虚拟化，原本多台物理服务器可整合到较少数量的物理服务器上，降低能源成本和减少对环境的负担。</li>
<li><strong>充裕的资金</strong>：服务器虚拟化可以帮助企业节省资金，例如通过减少许可证费用，因为可以在多个虚拟机上共享一个许可证。</li>
<li><strong>便捷易部署</strong>：部署服务器变得简单快捷，类似于拼积木的方式，随时按需扩容，灵活搭建，定制属于自己的服务器。</li>
</ol>
<h2 id="服务器虚拟化分类"><a href="#服务器虚拟化分类" class="headerlink" title="服务器虚拟化分类"></a>服务器虚拟化分类</h2><blockquote>
<p>下方学习的就是kvm虚拟化，公有云也是基于kvm实现的虚拟化技术</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看虚拟机是什么虚拟化技术</span><br><span class="line">lscpu  <span class="operator">|</span>grep <span class="operator">-</span>i <span class="operator">^</span>hypervisor</span><br></pre></td></tr></table></figure>
</blockquote>
<ol>
<li>全虚拟化（Full  Virtualization）：在全虚拟化中，虚拟机可以运行完整的操作系统，包括客户操作系统，而无需对应用程序进行修改。这种虚拟化技术通常需要一个虚拟机监视器（VMM）或hypervisor来管理虚拟机和物理硬件之间的交互。KVM、VMware和Hyper-V等都是常见的全虚拟化平台。</li>
<li>半虚拟化（Paravirtualization）：在半虚拟化中，客户操作系统需要进行修改以便与虚拟化平台进行通信，以提高性能和效率。半虚拟化可以显著降低虚拟化开销，但需要对操作系统进行修改，因此不太灵活。Xen是一个常见的半虚拟化平台。</li>
<li>容器虚拟化（Containerization）：容器虚拟化是一种轻量级的虚拟化技术，它利用操作系统级虚拟化来隔离应用程序和它们的依赖项。容器共享宿主操作系统的内核，并且不需要独立的操作系统实例，因此比传统虚拟化更加轻量级和高效。Docker和Kubernetes是常见的容器化平台。</li>
<li>硬件辅助虚拟化（Hardware-assisted Virtualization）：这种虚拟化利用硬件的虚拟化扩展（如Intel  VT-x和AMD-V）来提高虚拟化性能和效率。这些扩展使得虚拟机可以直接访问物理硬件，而无需通过虚拟机监视器进行翻译和转发。这种虚拟化技术通常用于全虚拟化和半虚拟化环境中。</li>
</ol>
<p>这些是常见的服务器虚拟化分类，每种技术都有其优点和适用场景，可以根据具体的需求选择合适的虚拟化技术。</p>
<p><strong>图解对比vmware与kvm虚拟虚拟化技术区别</strong></p>
<p><img src="/image-20240716140237484.png" alt="image-20240716140237484"></p>
<h2 id="kvm虚拟化技术"><a href="#kvm虚拟化技术" class="headerlink" title="kvm虚拟化技术"></a>kvm虚拟化技术</h2><p>KVM（Kernel-based Virtual  Machine）是一种全虚拟化的虚拟化技术。它利用Linux内核提供的虚拟化技术，允许在一个物理服务器上创建多个虚拟机，每个虚拟机可以运行完整的操作系统。KVM利用硬件辅助虚拟化技术（如Intel  VT-x和AMD-V）来提高性能和效率，并且支持多种操作系统，包括Linux、Windows等。KVM通常作为一个基于Linux的开源虚拟化解决方案，被广泛应用于数据中心和云计算环境中。</p>
<p><strong>技术原理</strong></p>
<ol>
<li>主机（宿主机）的硬件虚拟化扩展：KVM依赖于硬件的虚拟化扩展，如Intel VT-x或AMD-V，这些扩展允许虚拟机管理程序访问处理器的虚拟化功能，从而在虚拟机内运行客户操作系统。</li>
<li>KVM内核模块：KVM虚拟化是基于Linux内核的虚拟化技术，因此首先需要加载KVM内核模块，它允许Linux内核作为虚拟化宿主，并提供了一组API供用户空间管理程序使用。</li>
<li>基于QEMU的虚拟机管理：KVM依赖于QEMU（Quick Emulator）来模拟虚拟机的硬件。QEMU通过KVM模块和硬件虚拟化扩展提供加速，同时可以与KVM协同工作，比如处理设备模拟和I&#x2F;O操作。</li>
<li>客户操作系统运行：虚拟机管理程序使用KVM和QEMU创建虚拟机，并在其内部执行客户操作系统。这些客户操作系统以完全虚拟化的方式运行，即在虚拟处理器上执行。客户操作系统不需要进行代码修改，因为KVM提供了对操作系统的全面支持。</li>
</ol>
<p>总的来说，KVM虚拟化技术通过利用硬件虚拟化扩展、Linux内核模块和QEMU来实现在宿主机上创建和管理多个虚拟机，从而使得不同的操作系统可以在同一物理服务器上并行运行。</p>
<p><strong>kvm所需组件</strong></p>
<p>KVM（Kernel-based Virtual Machine）虚拟化技术包含以下主要组件：</p>
<ol>
<li>KVM内核模块：KVM核心模块是Linux内核的一部分，它允许将Linux内核转变为一个虚拟化宿主。这个模块提供了一系列的API，供用户空间的虚拟机管理程序使用。</li>
<li>QEMU（Quick Emulator）：QEMU是一个开源的虚拟化模拟器，它可以模拟多种硬件设备，并提供虚拟机管理功能。在KVM中，QEMU与KVM协同工作，KVM负责虚拟化处理器和内存管理，而QEMU负责设备模拟和I&#x2F;O操作。</li>
<li>libvirt：libvirt是一个用于管理虚拟化平台的开源工具集，它提供了一个统一的管理接口，并支持多种虚拟化技术，包括KVM。libvirt可以用来管理虚拟机的创建、启动、停止、迁移等操作。</li>
<li>虚拟机管理程序：虚拟机管理程序是指实际用来创建和管理虚拟机的用户空间工具，例如virt-manager、oVirt和OpenStack等。这些工具提供了图形用户界面或命令行接口，用来配置、监控和管理虚拟机。</li>
</ol>
<p><strong>虚拟化扩展技术</strong></p>
<p>虚拟化扩展技术是一种硬件技术，它允许虚拟化软件更有效地利用计算机的处理器来创建和管理虚拟机。这意味着虚拟化扩展技术可以提高虚拟化软件的性能和效率。</p>
<p>举例来说，假设你有一台计算机，希望在上面同时运行多个虚拟机。使用虚拟化扩展技术，计算机的处理器可以直接支持虚拟化软件，使其更容易地创建和管理这些虚拟机。这样一来，每个虚拟机就可以更快速地访问计算机的硬件资源，提供更好的性能和响应速度。</p>
<h1 id="虚拟化kvm部署"><a href="#虚拟化kvm部署" class="headerlink" title="虚拟化kvm部署"></a>虚拟化kvm部署</h1><h2 id="1-虚拟化嵌套环境"><a href="#1-虚拟化嵌套环境" class="headerlink" title="1.虚拟化嵌套环境"></a>1.虚拟化嵌套环境</h2><blockquote>
<p>当前环境是windos电脑，使用虚拟化嵌套来完成虚拟化kvm部署；若是物理机本身就是linux系统，可直接使用kvm虚拟化</p>
<p><strong>完成效果：</strong></p>
<p>kvm宿主机：vmware虚拟机kvm-host（内存8G，cpu4核），将宿主机的硬件资源分配到kvm虚拟机上</p>
<p>↓</p>
<p>创建kvm虚拟机: kvm-web01(内存2g，cpu1核)</p>
</blockquote>
<p><img src="/image-20240713203119623.png" alt="image-20240713203119623"></p>
<h2 id="2-安装kvm管理工具"><a href="#2-安装kvm管理工具" class="headerlink" title="2.安装kvm管理工具"></a>2.安装kvm管理工具</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#安装kvm管理工具</span><br><span class="line">yum install libvirt virt<span class="operator">-</span>install qemu<span class="operator">-</span>kvm <span class="operator">-</span>y</span><br><span class="line">#启动虚拟器服务用于更好的管理虚拟化</span><br><span class="line">systemctl <span class="keyword">start</span> libvirtd.service</span><br><span class="line">systemctl status libvirtd.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#安装软件说明内容：</span><br><span class="line"><span class="operator">-</span> libvirt是一种用于管理虚拟化平台的库，提供了API和工具用于管理不同类型的虚拟化技术。</span><br><span class="line"><span class="operator">-</span> virt<span class="operator">-</span>install是一个命令行工具，用于通过交互式或非交互式的方式安装虚拟机。</span><br><span class="line"><span class="operator">-</span> qemu<span class="operator">-</span>kvm是一个基于内核的虚拟机监控程序，提供了虚拟化的基本功能。</span><br></pre></td></tr></table></figure>

<h2 id="3-安装VNC连接工具"><a href="#3-安装VNC连接工具" class="headerlink" title="3.安装VNC连接工具"></a>3.安装VNC连接工具</h2><ul>
<li>创建了kvm虚拟机需要图形化展示所以就得用vnc工具了</li>
</ul>
<blockquote>
<p>为了能够方便地查看和管理虚拟机的图形化界面，需要使用VNC连接来实现</p>
<p>这样可以通过VNC客户端连接到KVM宿主机映射的虚拟机端口，然后查看和操作虚拟机的图形化界面进行安装系统</p>
<p>VNC 是一种远程桌面协议，允许用户通过网络远程控制虚拟机的图形界面</p>
</blockquote>
<p>VNC是Virtual Network Computing的缩写，是一种远程桌面协议，允许用户通过网络远程访问和控制另一台计算机。VNC协议通过在远程计算机上运行服务器端软件，以及在本地计算机上运行客户端软件，实现了远程桌面的共享和控制。</p>
<p>通过VNC，用户可以在本地计算机上查看远程计算机的桌面，操作远程计算机上的应用程序，传输文件等。VNC协议具有跨平台的特性，因此可以在不同操作系统之间进行远程桌面连接，例如在Windows、Linux、MacOS等操作系统上都可以使用VNC进行远程控制。</p>
<p>有许多开源和商业的VNC软件，其中比较知名的有TightVNC、RealVNC、UltraVNC等。这些软件提供了VNC服务器和VNC客户端，使用户可以方便地进行远程桌面连接和控制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#安装的tighvnc工具</span><br><span class="line">https:<span class="operator">/</span><span class="operator">/</span>www.tightvnc.com<span class="operator">/</span>download<span class="operator">/</span><span class="number">2.8</span><span class="number">.63</span><span class="operator">/</span>tightvnc<span class="number">-2.8</span><span class="number">.63</span><span class="operator">-</span>gpl<span class="operator">-</span>setup<span class="number">-64</span>bit.msi</span><br></pre></td></tr></table></figure>

<p>下载安装默认都自定义即可，设置密码时可以修改为不需要密码使用该工具</p>
<p><img src="/image-20240714120736150.png" alt="image-20240714120736150"></p>
<h2 id="4-CPU支持虚拟化设置"><a href="#4-CPU支持虚拟化设置" class="headerlink" title="4.CPU支持虚拟化设置"></a>4.CPU支持虚拟化设置</h2><blockquote>
<p>宿主机的cpu需要支持虚拟化功能，当前使用的虚拟化嵌套所以需要在vm软件开启，关机后编辑即可</p>
<p>如果显示还是不支持，进行windows配置，关闭内存隔离等</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62166372/article/details/139127960">https://blog.csdn.net/m0_62166372/article/details/139127960</a></p>
</blockquote>
<p><img src="/image-20240714110850916.png" alt="image-20240714110850916"></p>
<h2 id="5-创建kvm虚拟机"><a href="#5-创建kvm虚拟机" class="headerlink" title="5.创建kvm虚拟机"></a>5.创建kvm虚拟机</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#环境准备，创建kvm虚拟机磁盘文件存储目录，上传linux系统镜像</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#mkdir <span class="operator">/</span>kvm_data</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">/</span>]#cd kvm_data<span class="operator">/</span></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">/</span>kvm_data]#ls</span><br><span class="line">CentOS<span class="number">-7</span><span class="operator">-</span>x86_64<span class="operator">-</span>DVD<span class="number">-2009.</span>iso</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#安装虚拟机，指定的参数如vm软件创建时进行鼠标点点点资源划分等</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">/</span>kvm_data]#virt<span class="operator">-</span>install <span class="comment">--virt-type kvm --os-type=linux --os-variant rhel7 --name kvm-web01 --memory 2048,memory=4096 --vcpus 2,maxvcpus=8  --disk /kvm_data/kvm-web01.raw,format=raw,size=10 --cdrom  /kvm_data/CentOS-7-x86_64-DV009.iso --network network=default --graphics vnc,listen=0.0.0.0  --noautoconsole</span></span><br><span class="line"></span><br><span class="line">Starting install...</span><br><span class="line">Allocating <span class="string">&#x27;kvm-web01.raw&#x27;</span>                                                                           <span class="operator">|</span>  <span class="number">10</span> GB  <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  </span><br><span class="line">Domain installation still <span class="keyword">in</span> progress. You can reconnect <span class="keyword">to</span> </span><br><span class="line">the console <span class="keyword">to</span> complete the installation process.</span><br><span class="line">安装仍在进行中您可以重新连接到控制台以完成安装过程,vnc连接安装linux系统</span><br></pre></td></tr></table></figure>

<p><strong>参数解释</strong></p>
<p><code>–virt-type kvm:</code> 指定虚拟化类型为KVM。</p>
<p><code>–os-type=linux:</code> 指定操作系统类型为Linux。</p>
<p><code>–os-variant rhel7: </code>指定操作系统变种为RHEL 7。</p>
<p><code>–name kvm-web01:</code> 指定虚拟机的名称为kvm01</p>
<p><code>–memory 2048,maxmemory=4096:</code> 指定虚拟机的内存为2048MB，最大内存为4096MB。【kvm虚拟机一旦创建后面增加硬件资源时只能关机进行，想实现热添加就得参数设置一个最大值】</p>
<p><code>–vcpus 2,maxvcpus=8: </code>指定虚拟机的虚拟CPU个数为2个，最大虚拟CPU个数为8个。【kvm虚拟机一旦创建后面增加硬件资源时只能关机进行，想实现热添加就得参数设置一个最大值】</p>
<p><code>–disk /kvm_data/kvm-web01.raw,format=raw,size=10:</code> 指定虚拟机的磁盘为&#x2F;kvm_data&#x2F;kvm01.raw，格式为raw，大小为10GB。 【磁盘文件存储目录需要提前创建】</p>
<p><code>–cdrom /kvm_data/CentOS-7-x86_64-DVD-1804.iso:</code> 指定虚拟机的光驱镜像为CentOS-7-x86_64-DVD-1804.iso。【镜像得提前拉取到宿主机】 </p>
<p><code>–network network=default:</code> 指定虚拟机连接的网络为默认网络。【默认网络是NAT模式创建个局域网给内网主机分配ip，通外网走公网网关】</p>
<p><code>–graphics vnc,listen=0.0.0.0:</code> 启用VNC图形化界面，允许通过任何IP地址连接到虚拟机的VNC服务。</p>
<p><code>–noautoconsole:</code> 禁止虚拟机控制台，输出其他地方执行命令后得结果信息</p>
<h2 id="6-vnc连接安装系统"><a href="#6-vnc连接安装系统" class="headerlink" title="6.vnc连接安装系统"></a>6.vnc连接安装系统</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1.查看虚拟机信息</span><br><span class="line"><span class="comment">#查看运行的虚拟机</span></span><br><span class="line">[root@kvm-host ~]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 1     kvm-web01                      running</span><br><span class="line"><span class="comment">#查看所有虚拟机包括未运行的</span></span><br><span class="line">[root@kvm-host ~]#virsh list --all</span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 1     kvm-web01                      running</span><br><span class="line"><span class="comment">#查看虚拟机网络连接接口地址，当前未安装系统所以无信息</span></span><br><span class="line">[root@kvm-host ~]#virsh domifaddr kvm-web01</span><br><span class="line"> Name       MAC address          Protocol     Address</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.查看vnc端口连接虚拟机</span><br><span class="line"><span class="comment">#查看VNC端口，由vnc管理工具开启的端口，专门供vnc连接虚拟机</span></span><br><span class="line">[root@kvm-host ~]#virsh vncdisplay kvm-web01</span><br><span class="line">:0</span><br><span class="line"><span class="comment">#虚拟机的vnc端口会在宿主机也映射一个，通过这个也可以连接虚拟机（vnc工具提供的为了方便不用关注）</span></span><br><span class="line">[root@kvm-host ~]#ss -tunlp|grep 5900</span><br><span class="line">tcp    LISTEN     0      1         *:5900                  *:*                   <span class="built_in">users</span>:((&quot;qemu-kvm&quot;,pid=<span class="number">2284</span>,fd=<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.使用vnc工具输入宿主机的ip地址及vnc端口即可连接</span><br></pre></td></tr></table></figure>

<p><img src="/image-20240714122627551.png" alt="image-20240714122627551"></p>
<hr>
<blockquote>
<p>安装系统即可</p>
</blockquote>
<p><img src="/image-20240714122650324.png" alt="image-20240714122650324"></p>
<h2 id="7-kvm虚拟机辅助文件"><a href="#7-kvm虚拟机辅助文件" class="headerlink" title="7.kvm虚拟机辅助文件"></a>7.kvm虚拟机辅助文件</h2><ul>
<li>都是在宿主机上面存储的</li>
</ul>
<ol>
<li>镜像文件：用于存储虚拟机的操作系统和应用程序，通常以qcow2、raw等格式存储虚拟机的磁盘镜像。</li>
<li>XML配置文件：描述虚拟机的配置信息，包括虚拟机的硬件设置、网络配置、存储配置等。</li>
<li>快照文件：用于保存虚拟机当前状态的快照，可以在以后恢复到这个状态。</li>
<li>日志文件：记录虚拟机的运行日志和事件信息。</li>
</ol>
<blockquote>
<p>关键的两个辅助文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#磁盘镜像文件，存储了kvm虚拟机的磁盘数据</span></span><br><span class="line">[root@kvm-host ~]#<span class="built_in">cd</span> /kvm_data/</span><br><span class="line">[root@kvm-host /kvm_data]#ll</span><br><span class="line">total 6279404</span><br><span class="line">-rw-r--r--. 1 qemu qemu  4712300544 Jul 14 11:52 CentOS-7-x86_64-DVD-2009.iso</span><br><span class="line">-rw-------. 1 root root 10737418240 Jul 14 14:31 kvm-web01.raw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#xml配置文件，定义了kvm虚拟机的各种信息（通过定义的这些信息从而创建的虚拟机）</span></span><br><span class="line">[root@kvm-host /kvm_data]#<span class="built_in">ls</span> /etc/libvirt/qemu</span><br><span class="line">kvm-web01.xml  networks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看虚拟机此时状态的参数信息</span></span><br><span class="line">virsh dumpxml 虚拟机名</span><br></pre></td></tr></table></figure>

<p><img src="/image-20240714204338021.png" alt="image-20240714204338021"></p>
<ol>
<li><code>&lt;domain type=&#39;kvm&#39;&gt;</code> - 定义虚拟机类型为KVM。</li>
<li><code>&lt;name&gt;kvm-web01&lt;/name&gt;</code> - 虚拟机的名称为kvm-web01。</li>
<li><code>&lt;uuid&gt;6634fc41-05c8-48b2-b0fa-978e1f70de67&lt;/uuid&gt;</code> - 虚拟机的唯一标识符。</li>
<li><code>&lt;memory unit=&#39;KiB&#39;&gt;4194304&lt;/memory&gt;</code> - 虚拟机的内存大小为4194304 KiB。</li>
<li><code>&lt;currentMemory unit=&#39;KiB&#39;&gt;2097152&lt;/currentMemory&gt;</code> - 当前内存使用量为2097152 KiB。</li>
<li><code>&lt;vcpu placement=&#39;static&#39; current=&#39;2&#39;&gt;8&lt;/vcpu&gt;</code> - 虚拟CPU的数量为8。</li>
<li><code>&lt;os&gt;</code> - 定义虚拟机的操作系统配置。</li>
<li><code>&lt;type arch=&#39;x86_64&#39; machine=&#39;pc-i440fx-rhel7.0.0&#39;&gt;hvm&lt;/type&gt;</code> - 操作系统类型为hvm，架构为x86_64，机器类型为pc-i440fx-rhel7.0.0。</li>
<li><code>&lt;boot dev=&#39;hd&#39;/&gt;</code> - 定义启动设备为硬盘。</li>
<li><code>&lt;features&gt;</code> - 定义虚拟机的特性。</li>
<li><code>&lt;acpi/&gt;</code> - 启用ACPI（高级配置与电源接口）。</li>
<li><code>&lt;apic/&gt;</code> - 启用APIC（高级可编程中断控制器）。</li>
<li><code>&lt;cpu mode=&#39;custom&#39; match=&#39;exact&#39; check=&#39;partial&#39;&gt;</code> - 定义CPU的配置。</li>
<li><code>&lt;model fallback=&#39;allow&#39;&gt;Broadwell-noTSX-IBRS&lt;/model&gt;</code> - CPU模型为Broadwell-noTSX-IBRS。</li>
<li><code>&lt;feature policy=&#39;require&#39; name=&#39;md-clear&#39;/&gt;</code> - CPU特性中启用md-clear。</li>
<li><code>&lt;feature policy=&#39;require&#39; name=&#39;spec-ctrl&#39;/&gt;</code> - CPU特性中启用spec-ctrl。</li>
<li><code>&lt;feature policy=&#39;require&#39; name=&#39;ssbd&#39;/&gt;</code> - CPU特性中启用ssbd。</li>
<li><code>&lt;clock offset=&#39;utc&#39;&gt;</code> - 定义时钟配置，偏移为UTC。</li>
<li><code>&lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</code> - 虚拟机关机时执行销毁操作。</li>
<li><code>&lt;on_reboot&gt;restart&lt;/on_reboot&gt;</code> - 虚拟机重启时执行重启操作。</li>
<li><code>&lt;on_crash&gt;destroy&lt;/on_crash&gt;</code> - 虚拟机崩溃时执行销毁操作。</li>
<li><code>&lt;pm&gt;</code> - 定义电源管理配置。</li>
<li><code>&lt;suspend-to-mem enabled=&#39;no&#39;/&gt;</code> - 禁用挂起到内存功能。</li>
<li><code>&lt;suspend-to-disk enabled=&#39;no&#39;/&gt;</code> - 禁用挂起到磁盘功能。</li>
<li><code>&lt;devices&gt;</code> - 定义虚拟机的设备配置。</li>
</ol>
<h1 id="登录kvm虚拟机"><a href="#登录kvm虚拟机" class="headerlink" title="登录kvm虚拟机"></a>登录kvm虚拟机</h1><blockquote>
<p>初次创建的虚拟机记得登录时将防火墙关闭，与vm软件创建好，使用虚拟机的流程一样</p>
</blockquote>
<h2 id="1-终端连接"><a href="#1-终端连接" class="headerlink" title="1.终端连接"></a>1.终端连接</h2><p>terminel终端连接：</p>
<ul>
<li>基于命令行，适合远程管理和操作虚拟机。</li>
<li>通常使用 SSH协议 连接到虚拟机，可以执行命令行操作，适合对虚拟机进行远程管理和维护</li>
</ul>
<blockquote>
<p>虚拟机必须已安装好系统有网卡地址，宿主机方可连接</p>
<p>终端连接只要用于远程的网络连接，连接后生成终端命令行</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>连接虚拟机</span><br><span class="line">#查看虚拟机网卡地址</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh domifaddr kvm<span class="operator">-</span>web01</span><br><span class="line"> Name       MAC address          Protocol     Address</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line"> vnet0      <span class="number">52</span>:<span class="number">54</span>:<span class="number">00</span>:a2:a8:<span class="number">2</span>d    ipv4         <span class="number">192.168</span><span class="number">.122</span><span class="number">.158</span><span class="operator">/</span><span class="number">24</span></span><br><span class="line">#宿主机网卡作为局域网的网关，所以可以基于同一网段ssh连接</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#ifconfig virbr0</span><br><span class="line">virbr0: flags<span class="operator">=</span><span class="number">4163</span><span class="operator">&lt;</span>UP,BROADCAST,<span class="keyword">RUNNING</span>,MULTICAST<span class="operator">&gt;</span>  mtu <span class="number">1500</span></span><br><span class="line">        inet <span class="number">192.168</span><span class="number">.122</span><span class="number">.1</span>  netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>  broadcast <span class="number">192.168</span><span class="number">.122</span><span class="number">.255</span></span><br><span class="line">        ether <span class="number">52</span>:<span class="number">54</span>:<span class="number">00</span>:a8:<span class="number">5</span>d:f2  txqueuelen <span class="number">1000</span>  (Ethernet)</span><br><span class="line">        RX packets <span class="number">1267</span>  bytes <span class="number">107243</span> (<span class="number">104.7</span> KiB)</span><br><span class="line">        RX errors <span class="number">0</span>  dropped <span class="number">0</span>  overruns <span class="number">0</span>  frame <span class="number">0</span></span><br><span class="line">        TX packets <span class="number">1478</span>  bytes <span class="number">130035</span> (<span class="number">126.9</span> KiB)</span><br><span class="line">        TX errors <span class="number">0</span>  dropped <span class="number">0</span> overruns <span class="number">0</span>  carrier <span class="number">0</span>  collisions <span class="number">0</span></span><br><span class="line">#ssh连接虚拟机      </span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#ssh root<span class="variable">@192</span><span class="number">.168</span><span class="number">.122</span><span class="number">.158</span></span><br><span class="line">root<span class="variable">@192</span><span class="number">.168</span><span class="number">.122</span><span class="number">.158</span>s password: </span><br><span class="line"><span class="keyword">Last</span> login: Sun Jul <span class="number">14</span> <span class="number">09</span>:<span class="number">05</span>:<span class="number">00</span> <span class="number">2024</span> <span class="keyword">from</span> gateway</span><br><span class="line">#连接成功进入到了虚拟机，查看硬件信息，创建好的虚拟机相当于一个独立的机器</span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# lscpu<span class="operator">|</span>grep <span class="operator">-</span>iw <span class="string">&#x27;^cpu(s)&#x27;</span></span><br><span class="line">CPU(s):                <span class="number">2</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# <span class="keyword">free</span> <span class="operator">-</span>m</span><br><span class="line">              total        used        <span class="keyword">free</span>      shared  buff<span class="operator">/</span>cache   available</span><br><span class="line">Mem:           <span class="number">1740</span>         <span class="number">231</span>        <span class="number">1371</span>           <span class="number">8</span>         <span class="number">137</span>        <span class="number">1318</span></span><br><span class="line">Swap:          <span class="number">1023</span>           <span class="number">0</span>        <span class="number">1023</span></span><br><span class="line">[root<span class="variable">@localhost</span> <span class="operator">~</span>]# fdisk <span class="operator">-</span>l <span class="operator">|</span>grep <span class="operator">-</span>w <span class="string">&#x27;/dev/vda&#x27;</span></span><br><span class="line">Disk <span class="operator">/</span>dev<span class="operator">/</span>vda: <span class="number">10.7</span> GB, <span class="number">10737418240</span> bytes, <span class="number">20971520</span> sectors</span><br><span class="line">[root<span class="variable">@localhost</span> yum.repos.d]# ls</span><br><span class="line">CentOS<span class="operator">-</span>Base.repo  CentOS<span class="operator">-</span>Debuginfo.repo  CentOS<span class="operator">-</span>Media.repo    CentOS<span class="operator">-</span>Vault.repo          epel.repo</span><br><span class="line">CentOS<span class="operator">-</span>CR.repo    CentOS<span class="operator">-</span>fasttrack.repo  CentOS<span class="operator">-</span>Sources.repo  CentOS<span class="operator">-</span>x86_64<span class="operator">-</span>kernel.repo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>虚拟机安装nginx及相关工具，测试是否可以像一个独立的机器可以提供web访问</span><br><span class="line">#拷贝宿主机的yum配置</span><br><span class="line">[root<span class="variable">@localhost</span> yum.repos.d]# scp root<span class="variable">@10</span><span class="number">.0</span><span class="number">.0</span><span class="number">.103</span>:<span class="operator">/</span>etc<span class="operator">/</span>yum.repos.d<span class="comment">/* ./</span></span><br><span class="line"><span class="comment">root@10.0.0.103s password: </span></span><br><span class="line"><span class="comment">scp: /etc/yum.repos.d/backup: not a regular file</span></span><br><span class="line"><span class="comment">CentOS-Base.repo                                                                      100% 2523   110.6KB/s   00:00    </span></span><br><span class="line"><span class="comment">epel.repo                                                                             100%  664   221.8KB/s   00:00    </span></span><br><span class="line"><span class="comment">[root@localhost yum.repos.d]# ls</span></span><br><span class="line"><span class="comment">CentOS-Base.repo  CentOS-Debuginfo.repo  CentOS-Media.repo    CentOS-Vault.repo          epel.repo</span></span><br><span class="line"><span class="comment">CentOS-CR.repo    CentOS-fasttrack.repo  CentOS-Sources.repo  CentOS-x86_64-kernel.repo</span></span><br><span class="line"><span class="comment">#为啥虚拟机可以连接宿主机10网段的地址进行拷贝，是因为宿主机iptables开放了规则</span></span><br><span class="line"><span class="comment">[root@kvm-host ~]#iptables -nL | sed -n &#x27;/Chain FORWARD/,/^$/p&#x27;</span></span><br><span class="line"><span class="comment">Chain FORWARD (policy ACCEPT)</span></span><br><span class="line"><span class="comment">target     prot opt source               destination         </span></span><br><span class="line"><span class="comment">ACCEPT     all  --  0.0.0.0/0            192.168.122.0/24     ctstate RELATED,ESTABLISHED</span></span><br><span class="line"><span class="comment">ACCEPT     all  --  192.168.122.0/24     0.0.0.0/0           </span></span><br><span class="line"><span class="comment">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           </span></span><br><span class="line"><span class="comment">REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable</span></span><br><span class="line"><span class="comment">REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable</span></span><br><span class="line"><span class="comment">#快速加载yum源缓存，fast会优先去yum源中下载更新的软件包元数据，而makecache新旧一起下</span></span><br><span class="line"><span class="comment">yum makecache fast</span></span><br><span class="line"><span class="comment">yum install vim net-tools nginx -y</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">3.宿主机测试访问虚拟机的nginx</span></span><br><span class="line"><span class="comment">#只可以通过与虚拟机同一网段主机连接，本地自己访问肯定不行，使用宿主机连接</span></span><br><span class="line"><span class="comment">[root@kvm-host ~]#curl -I  192.168.122.158</span></span><br><span class="line"><span class="comment">curl: (7) Failed connect to 192.168.122.158:80; No route to host</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">4.虚拟机修复无法访问原因，默认防火墙策略导致</span></span><br><span class="line"><span class="comment">#修改个主机名</span></span><br><span class="line"><span class="comment">hostnamectl set-hostname kvm-web01</span></span><br><span class="line"><span class="comment">#新创建的kvm虚拟机与vm软件创建的一样默认开机都会有防火墙策略</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#getenforce</span></span><br><span class="line"><span class="comment">Enforcing</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#iptables  -nL</span></span><br><span class="line"><span class="comment">Chain INPUT (policy ACCEPT)</span></span><br><span class="line"><span class="comment">target     prot opt source               destination         </span></span><br><span class="line"><span class="comment">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED</span></span><br><span class="line"><span class="comment">ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           </span></span><br><span class="line"><span class="comment">INPUT_direct  all  --  0.0.0.0/0            0.0.0.0/0           </span></span><br><span class="line"><span class="comment">-----------------规则省略</span></span><br><span class="line"><span class="comment">#关闭防护墙即可</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#iptables -F</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#iptables -X</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#iptables -X</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#systemctl disable firewalld</span></span><br><span class="line"><span class="comment">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span></span><br><span class="line"><span class="comment">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#systemctl stop firewalld</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#vim /etc/selinux/config </span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#grep &#x27;disabled&#x27; /etc/selinux/config </span></span><br><span class="line"><span class="comment">#     disabled - No SELinux policy is loaded.</span></span><br><span class="line"><span class="comment">SELINUX=disabled</span></span><br><span class="line"><span class="comment">#修改selinux需要重启生效</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]#reboot</span></span><br><span class="line"><span class="comment">Connection to 192.168.122.158 closed by remote host.</span></span><br><span class="line"><span class="comment">Connection to 192.168.122.158 closed.</span></span><br><span class="line"><span class="comment">远程主机关闭了与 192.168.122.158 的连接</span></span><br><span class="line"><span class="comment">与 192.168.122.158 的连接已关闭</span></span><br><span class="line"><span class="comment">#重启后宿主机再次连接</span></span><br><span class="line"><span class="comment">[root@kvm-host ~]#virsh list</span></span><br><span class="line"><span class="comment"> Id    Name                           State</span></span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"><span class="comment"> 5     kvm-web01                      running</span></span><br><span class="line"><span class="comment">[root@kvm-host ~]#ssh root@192.168.122.158</span></span><br><span class="line"><span class="comment">root@192.168.122.158s password: </span></span><br><span class="line"><span class="comment">Last login: Sun Jul 14 23:40:43 2024 from gateway</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# </span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# </span></span><br><span class="line"><span class="comment">#连接后虚拟机查看本地的防火墙都关闭了</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# iptables -nL</span></span><br><span class="line"><span class="comment">Chain INPUT (policy ACCEPT)</span></span><br><span class="line"><span class="comment">target     prot opt source               destination         </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Chain FORWARD (policy ACCEPT)</span></span><br><span class="line"><span class="comment">target     prot opt source               destination         </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Chain OUTPUT (policy ACCEPT)</span></span><br><span class="line"><span class="comment">target     prot opt source               destination         </span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# getenforce</span></span><br><span class="line"><span class="comment">Disabled</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">5.再次访问虚拟机nginx，访问成功</span></span><br><span class="line"><span class="comment">#虚拟机启动nginx</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# systemctl start nginx</span></span><br><span class="line"><span class="comment">[root@kvm-web01 ~]# netstat -tunlp|grep nginx</span></span><br><span class="line"><span class="comment">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1573/nginx: master  </span></span><br><span class="line"><span class="comment">tcp6       0      0 :::80                   :::*                    LISTEN      1573/nginx: master  </span></span><br><span class="line"><span class="comment">#宿主机测试访问</span></span><br><span class="line"><span class="comment">[root@kvm-host ~]#curl -I 192.168.122.158</span></span><br><span class="line"><span class="comment">HTTP/1.1 200 OK</span></span><br><span class="line"><span class="comment">Server: nginx/1.20.1</span></span><br><span class="line"><span class="comment">Date: Mon, 15 Jul 2024 06:57:42 GMT</span></span><br><span class="line"><span class="comment">Content-Type: text/html</span></span><br><span class="line"><span class="comment">Content-Length: 4833</span></span><br><span class="line"><span class="comment">Last-Modified: Fri, 16 May 2014 15:12:48 GMT</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">ETag: &quot;53762af0-12e1&quot;</span></span><br><span class="line"><span class="comment">Accept-Ranges: bytes</span></span><br></pre></td></tr></table></figure>

<h2 id="2-控制台连接"><a href="#2-控制台连接" class="headerlink" title="2.控制台连接"></a>2.控制台连接</h2><blockquote>
<p>console连接主要用于 <code>本地连接</code>  <code>无网络</code>   的虚拟机，通过虚拟串口进行连接</p>
</blockquote>
<p>console控制台连接：</p>
<ul>
<li>通过虚拟化管理工具直接连接到虚拟机的控制台界面，可以进行虚拟机的监控、配置和管理</li>
<li>通常用于本地管理虚拟机，提供了更直观的图形化界面进行管理</li>
<li>虚拟机无网络关机的情况下，使用console连接，通过参数将虚拟机输出信息发送到串口，console连接串口生成控制台页面进行操作</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#加载内核参数，将虚拟机的输出信息发送到串口（数据传输的接口）</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>web01 <span class="operator">~</span>]# grubby <span class="comment">--update-kernel=ALL --args=&quot;console=ttyS0,115200n8&quot;</span></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>web01 <span class="operator">~</span>]# reboot</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#宿主机通过串口使用console连接kvm虚拟机，显示虚拟机命令行控制台页面</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh console kvm<span class="operator">-</span>web01</span><br><span class="line">Connected <span class="keyword">to</span> domain kvm<span class="operator">-</span>web01</span><br><span class="line"><span class="keyword">Escape</span> <span class="type">character</span> <span class="keyword">is</span> <span class="operator">^</span>]</span><br><span class="line"></span><br><span class="line">CentOS Linux <span class="number">7</span> (Core)</span><br><span class="line">Kernel <span class="number">3.10</span><span class="number">.0</span><span class="number">-1160.</span>el7.x86_64 <span class="keyword">on</span> an x86_64</span><br><span class="line">kvm<span class="operator">-</span>web01 login: root</span><br><span class="line">Password: </span><br><span class="line"><span class="keyword">Last</span> failed login: Mon Jul <span class="number">15</span> <span class="number">03</span>:<span class="number">31</span>:<span class="number">29</span> EDT <span class="number">2024</span> <span class="keyword">on</span> ttyS0</span><br><span class="line">There was <span class="number">1</span> failed login attempt since the <span class="keyword">last</span> successful login.</span><br><span class="line"><span class="keyword">Last</span> login: Mon Jul <span class="number">15</span> <span class="number">00</span>:<span class="number">54</span>:<span class="number">03</span> <span class="keyword">from</span> gateway</span><br><span class="line">#连接上来了</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>web01 <span class="operator">~</span>]# </span><br></pre></td></tr></table></figure>

<p><strong>ctrl ] 可退出console页面</strong></p>
<p><img src="/image-20240715155603239.png" alt="image-20240715155603239"></p>
<h2 id="3-虚拟网络计算连接"><a href="#3-虚拟网络计算连接" class="headerlink" title="3.虚拟网络计算连接"></a>3.虚拟网络计算连接</h2><blockquote>
<p>主要用于图形化 <code>远程连接</code> 、<code>管理虚拟机</code>，做一些 <code>图形化</code> 的操作</p>
</blockquote>
<p>VNC 连接：</p>
<ul>
<li>提供了图形化的远程连接方式，通过 VNC 客户端可以远程连接到虚拟机的图形界面，跟在本地操作一个计算机一样。</li>
<li>适合需要图形界面的虚拟机管理和操作，例如进行图形化的安装、配置和管理。</li>
</ul>
<p><strong>连接宿主机ip与虚拟机vnc端口即可</strong></p>
<p><img src="/image-20240715154708940.png" alt="image-20240715154708940"></p>
<h1 id="虚拟机管理命令"><a href="#虚拟机管理命令" class="headerlink" title="虚拟机管理命令"></a>虚拟机管理命令</h1><blockquote>
<p>宿主机上管理创建的虚拟机命令</p>
</blockquote>
<h2 id="1-查看虚拟机信息"><a href="#1-查看虚拟机信息" class="headerlink" title="1.查看虚拟机信息"></a>1.查看虚拟机信息</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#查看正在运行的虚拟机</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">2</span>     kvm<span class="operator">-</span>web01                      <span class="keyword">running</span></span><br><span class="line">#查看所有虚拟机包括未运行的</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list <span class="comment">--all</span></span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">2</span>     kvm<span class="operator">-</span>web01                      <span class="keyword">running</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> #查看运行虚拟机的网络信息</span><br><span class="line"> [root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh domifaddr kvm<span class="operator">-</span>web01</span><br><span class="line"> Name       MAC address          Protocol     Address</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line"> vnet0      <span class="number">52</span>:<span class="number">54</span>:<span class="number">00</span>:a2:a8:<span class="number">2</span>d    ipv4         <span class="number">192.168</span><span class="number">.122</span><span class="number">.158</span><span class="operator">/</span><span class="number">24</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">#查看虚拟机配置信息</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh dumpxml kvm<span class="operator">-</span>web01</span><br><span class="line">#将虚拟机配置信息导出，用于备份配置或者用于热更新导出文件加载</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh dumpxml kvm<span class="operator">-</span>web01 <span class="operator">&gt;</span> kvm<span class="operator">-</span>web01<span class="operator">-</span>new.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看虚拟机vnc端口，宿主机本地也会映射一个，<span class="number">590</span><span class="operator">+</span>vnc端口，连哪个都可以</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh vncdisplay kvm<span class="operator">-</span>web01 </span><br><span class="line">:<span class="number">0</span></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#ss <span class="operator">-</span>tunlp<span class="operator">|</span>grep kvm</span><br><span class="line">tcp    LISTEN     <span class="number">0</span>      <span class="number">1</span>         <span class="operator">*</span>:<span class="number">5900</span>                  <span class="operator">*</span>:<span class="operator">*</span>                   users:((&quot;qemu-kvm&quot;,pid<span class="operator">=</span><span class="number">12747</span>,fd<span class="operator">=</span><span class="number">19</span>))</span><br></pre></td></tr></table></figure>

<h2 id="2-虚拟机运行管理"><a href="#2-虚拟机运行管理" class="headerlink" title="2.虚拟机运行管理"></a>2.虚拟机运行管理</h2><p><strong>开启，关闭，重启，摧毁（立刻关闭）,挂起恢复虚拟机</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#关闭</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh shutdown kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 <span class="keyword">is</span> being shutdown</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list <span class="comment">--all</span></span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="operator">-</span>     kvm<span class="operator">-</span>web01                      shut off</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#开启</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh <span class="keyword">start</span> kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 started</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">4</span>     kvm<span class="operator">-</span>web01                      <span class="keyword">running</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重启</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh reboot kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 <span class="keyword">is</span> being rebooted</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">4</span>     kvm<span class="operator">-</span>web01                      <span class="keyword">running</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#摧毁（强制关机，相当于拔电源，会造成数据丢失）【使用场景当虚拟机卡死没法了只能强制关机】</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh destroy kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 destroyed</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#挂起恢复【对虚拟机进行暂停停止运行，但会保存当前虚拟机的状态，恢复后可快速还原到之前的状态】</span><br><span class="line">#暂停</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh suspend kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 suspended</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">5</span>     kvm<span class="operator">-</span>web01                      paused</span><br><span class="line">#恢复</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh resume kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 resumed</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh list</span><br><span class="line"> Id    Name                           State</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"> <span class="number">5</span>     kvm<span class="operator">-</span>web01                      <span class="keyword">running</span></span><br></pre></td></tr></table></figure>

<h2 id="3-虚拟机开机自启"><a href="#3-虚拟机开机自启" class="headerlink" title="3.虚拟机开机自启"></a>3.虚拟机开机自启</h2><blockquote>
<p>libvirtd服务不启动，虚拟机无法启动，启动必须依赖libcirtd</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#启动并设置开机自启libvirtd服务，管理虚拟机的服务</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#systemctl enable libvirtd</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#systemctl <span class="keyword">is</span><span class="operator">-</span>enabled libvirtd</span><br><span class="line">enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置宿主机开启时虚拟机自动开启</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh autostart kvm<span class="operator">-</span>web01</span><br><span class="line">Domain kvm<span class="operator">-</span>web01 marked <span class="keyword">as</span> autostarted</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#本质上是对配置文件设置了个软链接，libvirt开机自启后，自动加载虚拟机配置启动虚拟机</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#ll <span class="operator">/</span>etc<span class="operator">/</span>libvirt<span class="operator">/</span>qemu<span class="operator">/</span>autostart<span class="operator">/</span></span><br><span class="line">total <span class="number">0</span></span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root <span class="number">31</span> Jul <span class="number">15</span> <span class="number">10</span>:<span class="number">47</span> kvm<span class="operator">-</span>web01.xml <span class="operator">-</span><span class="operator">&gt;</span> <span class="operator">/</span>etc<span class="operator">/</span>libvirt<span class="operator">/</span>qemu<span class="operator">/</span>kvm<span class="operator">-</span>web01.xml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#取消虚拟机开启自启</span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#virsh autostart <span class="comment">--disable kvm-web01</span></span><br><span class="line">Domain kvm<span class="operator">-</span>web01 unmarked <span class="keyword">as</span> autostarted</span><br><span class="line"></span><br><span class="line">[root<span class="variable">@kvm</span><span class="operator">-</span>host <span class="operator">~</span>]#ll <span class="operator">/</span>etc<span class="operator">/</span>libvirt<span class="operator">/</span>qemu<span class="operator">/</span>autostart<span class="operator">/</span></span><br><span class="line">total <span class="number">0</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">赵东兴</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/20/%E8%99%9A%E6%8B%9F%E5%8C%96KVM-%E5%8E%9F%E7%90%86%E9%83%A8%E7%BD%B2/">http://example.com/2024/08/20/%E8%99%9A%E6%8B%9F%E5%8C%96KVM-%E5%8E%9F%E7%90%86%E9%83%A8%E7%BD%B2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/20/%E8%99%9A%E6%8B%9F%E5%8C%96KVM-%E5%8A%9F%E8%83%BD%E5%91%BD%E4%BB%A4/" title="虚拟化KVM-功能命令"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">虚拟化KVM-功能命令</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92/" title="容器Docker-单机编排"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">容器Docker-单机编排</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">赵东兴</div><div class="author-info__description">个人技术笔记博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">虚拟化原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%99%9A%E6%8B%9F%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">什么是虚拟化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">虚拟化分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">服务器虚拟化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E5%A5%BD%E5%A4%84"><span class="toc-number">1.4.</span> <span class="toc-text">服务器虚拟化好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96%E5%88%86%E7%B1%BB"><span class="toc-number">1.5.</span> <span class="toc-text">服务器虚拟化分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">1.6.</span> <span class="toc-text">kvm虚拟化技术</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96kvm%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">虚拟化kvm部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%99%9A%E6%8B%9F%E5%8C%96%E5%B5%8C%E5%A5%97%E7%8E%AF%E5%A2%83"><span class="toc-number">2.1.</span> <span class="toc-text">1.虚拟化嵌套环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85kvm%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.</span> <span class="toc-text">2.安装kvm管理工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85VNC%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%85%B7"><span class="toc-number">2.3.</span> <span class="toc-text">3.安装VNC连接工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-CPU%E6%94%AF%E6%8C%81%E8%99%9A%E6%8B%9F%E5%8C%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">4.CPU支持虚拟化设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%88%9B%E5%BB%BAkvm%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">2.5.</span> <span class="toc-text">5.创建kvm虚拟机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-vnc%E8%BF%9E%E6%8E%A5%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.6.</span> <span class="toc-text">6.vnc连接安装系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-kvm%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6"><span class="toc-number">2.7.</span> <span class="toc-text">7.kvm虚拟机辅助文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95kvm%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">3.</span> <span class="toc-text">登录kvm虚拟机</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BB%88%E7%AB%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.</span> <span class="toc-text">1.终端连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.2.</span> <span class="toc-text">2.控制台连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%A1%E7%AE%97%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3.虚拟网络计算连接</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">虚拟机管理命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">4.1.</span> <span class="toc-text">1.查看虚拟机信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">2.虚拟机运行管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="toc-number">4.3.</span> <span class="toc-text">3.虚拟机开机自启</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%9C%8D%E5%8A%A1%E4%BC%98%E5%8C%96/" title="数据库Redis-服务优化">数据库Redis-服务优化</a><time datetime="2024-08-20T03:44:08.000Z" title="Created 2024-08-20 11:44:08">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E5%88%86%E5%B8%83%E9%9B%86%E7%BE%A4/" title="数据库Redis-分布集群">数据库Redis-分布集群</a><time datetime="2024-08-20T03:43:56.000Z" title="Created 2024-08-20 11:43:56">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E5%93%A8%E5%85%B5%E5%8A%9F%E8%83%BD/" title="数据库Redis-哨兵功能">数据库Redis-哨兵功能</a><time datetime="2024-08-20T03:43:39.000Z" title="Created 2024-08-20 11:43:39">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="数据库Redis-主从复制">数据库Redis-主从复制</a><time datetime="2024-08-20T03:43:24.000Z" title="Created 2024-08-20 11:43:24">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/" title="数据库Redis-数据持久">数据库Redis-数据持久</a><time datetime="2024-08-20T03:43:10.000Z" title="Created 2024-08-20 11:43:10">2024-08-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 赵东兴</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>