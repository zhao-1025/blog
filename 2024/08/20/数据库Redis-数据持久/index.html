<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>数据库Redis-数据持久 | 一往无前虎山行,拨开云雾见光明</title><meta name="author" content="赵东兴"><meta name="copyright" content="赵东兴"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="redis数据持久化概述1.为什么需要持久化数据安全：持久化可以确保数据在发生意外情况（如服务器故障、断电等）时不会丢失，从而保障数据的安全性。 数据恢复：通过持久化，可以在系统重启后快速地将数据加载到内存中，从而实现数据的快速恢复。 数据复制：持久化可以作为备份手段，用于将数据复制到其他地方，以便在需要时进行恢复或者迁移数据。 2.什么情况会数据丢失 1.没有配置数据持久化方案，服务器突然断电导">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库Redis-数据持久">
<meta property="og:url" content="http://example.com/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/index.html">
<meta property="og:site_name" content="一往无前虎山行,拨开云雾见光明">
<meta property="og:description" content="redis数据持久化概述1.为什么需要持久化数据安全：持久化可以确保数据在发生意外情况（如服务器故障、断电等）时不会丢失，从而保障数据的安全性。 数据恢复：通过持久化，可以在系统重启后快速地将数据加载到内存中，从而实现数据的快速恢复。 数据复制：持久化可以作为备份手段，用于将数据复制到其他地方，以便在需要时进行恢复或者迁移数据。 2.什么情况会数据丢失 1.没有配置数据持久化方案，服务器突然断电导">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-08-20T03:43:10.000Z">
<meta property="article:modified_time" content="2024-08-20T04:03:18.736Z">
<meta property="article:author" content="赵东兴">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '数据库Redis-数据持久',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-20 12:03:18'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="一往无前虎山行,拨开云雾见光明" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="一往无前虎山行,拨开云雾见光明"><span class="site-name">一往无前虎山行,拨开云雾见光明</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据库Redis-数据持久</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-20T03:43:10.000Z" title="Created 2024-08-20 11:43:10">2024-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-08-20T04:03:18.736Z" title="Updated 2024-08-20 12:03:18">2024-08-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="数据库Redis-数据持久"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="redis数据持久化概述"><a href="#redis数据持久化概述" class="headerlink" title="redis数据持久化概述"></a>redis<strong>数据持久化概述</strong></h1><h2 id="1-为什么需要持久化"><a href="#1-为什么需要持久化" class="headerlink" title="1.为什么需要持久化"></a>1.为什么需要持久化</h2><p>数据安全：持久化可以确保数据在发生意外情况（如服务器故障、断电等）时不会丢失，从而保障数据的安全性。</p>
<p>数据恢复：通过持久化，可以在系统重启后快速地将数据加载到内存中，从而实现数据的快速恢复。</p>
<p>数据复制：持久化可以作为备份手段，用于将数据复制到其他地方，以便在需要时进行恢复或者迁移数据。</p>
<h2 id="2-什么情况会数据丢失"><a href="#2-什么情况会数据丢失" class="headerlink" title="2.什么情况会数据丢失"></a>2.什么情况会数据丢失</h2><blockquote>
<p>1.没有配置数据持久化方案，服务器突然断电导致服务挂掉</p>
<p>2.没有配置数据持久化方案，服务突然挂掉再次重启，</p>
<p>3.不友好中断服务，kill，pkill，killall</p>
</blockquote>
<h2 id="3-数据持久化方案"><a href="#3-数据持久化方案" class="headerlink" title="3.数据持久化方案"></a>3.数据持久化方案</h2><blockquote>
<p><strong>RDB（Redis 数据库备份）持久化</strong></p>
<p>RDB是根据配置的频率进行对某个时间的数据进行快照保存将当时的数据写入文件中</p>
<p>优点：数据保存的是二进制数据占用磁盘资源小，并且恢复时很快因为数据文件小</p>
<p>缺点：根据设置的保存点进行RDB，当没有触发特定条件，发生故障数据会出现部分丢失</p>
</blockquote>
<ul>
<li><strong>特点</strong>:<ul>
<li>RDB 是一种在指定时间间隔内保存 Redis 数据集的快照的持久化方式。</li>
<li>通过将数据集的快照写入磁盘文件，以保存数据的当前状态。</li>
<li>RDB 适合于备份数据、灾难恢复等场景。</li>
</ul>
</li>
<li><strong>优点</strong>:<ul>
<li>RDB 持久化文件相对较小，在恢复大型数据集时比 AOF 恢复速度更快。</li>
<li>适用于大规模数据恢复和迁移。</li>
</ul>
</li>
<li><strong>缺点</strong>:<ul>
<li>在故障发生时，可能会丢失最后一次持久化之后的数据改动。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>AOF（Append Only File）持久化</strong></p>
<p>AOF持久化是根据服务每执行一条命令便会对该命令进行保存写入文件中</p>
<p>优点：数据丢失可能性小，会对每一条命令都做一个记录</p>
<p>缺点：文件中的记录会占用大量的磁盘空间，并且恢复时速度会很慢</p>
</blockquote>
<ul>
<li><strong>特点</strong>:<ul>
<li>AOF 记录了写命令（包括写入、删除、更新等）的操作序列，以追加的方式将这些命令写入文件。</li>
<li>可以通过重新执行 AOF 文件来重建数据集。</li>
</ul>
</li>
<li><strong>优点</strong>:<ul>
<li>通过追加写的方式，AOF 可以保证数据的持久化，且不会丢失任何写命令。</li>
<li>AOF 文件本身是一个只进行追加操作的文件，不会出现数据写入错误导致的数据损坏问题。</li>
</ul>
</li>
<li><strong>缺点</strong>:<ul>
<li>AOF 文件一般比 RDB 文件大，恢复大型数据集时可能需要更长的时间。</li>
<li>在处理大量写入命令时，AOF 文件可能会变得较大。</li>
</ul>
</li>
</ul>
<p><strong>如何选择</strong></p>
<ul>
<li>如果对数据的最新状态要求不是非常严格，而且对数据的恢复速度有较高的要求，可以选择 RDB 持久化。</li>
<li>如果要求数据的完整性和不丢失任何写命令，同时对数据恢复的速度要求不是非常高，可以选择 AOF 持久化。</li>
<li>也可以同时启用 RDB 和 AOF 持久化，以确保数据的最佳安全性和恢复性。</li>
</ul>
<blockquote>
<p>总之，根据具体的业务需求和数据处理场景来选择和配置合适的持久化方式，以确保数据的安全性和完整性。</p>
</blockquote>
<h1 id="RDB数据持久化实战"><a href="#RDB数据持久化实战" class="headerlink" title="RDB数据持久化实战"></a>RDB数据持久化实战</h1><blockquote>
<p>触发方式：手动触发与自动触发</p>
</blockquote>
<h2 id="1-持久化命令save"><a href="#1-持久化命令save" class="headerlink" title="1.持久化命令save"></a>1.持久化命令save</h2><blockquote>
<p>不建议使用，redis服务是单线程服务，每次只接收1个请求执行1条命令</p>
<p>当使用save命令时，进行RDB持久化需要些时间，会造成其他请求等待堵塞，导致服务短暂的卡顿</p>
</blockquote>
<p><strong>服务卡顿影响</strong></p>
<p>当服务发生停顿时，会对业务和用户造成以下一系列不利影响：</p>
<p>服务不可用：停顿会导致服务不可用，用户无法访问或使用系统和应用程序，从而影响业务的正常进行。</p>
<p>用户体验下降：停顿会导致用户体验下降，用户可能会遇到延迟或超时错误，无法执行他们所需的操作，从而降低用户满意度。</p>
<p>数据丢失：如果在停顿期间发生故障或错误，可能会导致数据丢失或损坏。在数据库或缓存系统中，这可能会导致数据丢失或不一致，进而影响数据完整性。</p>
<p>业务受损：停顿可能会导致业务受到影响，例如订单处理、交易执行、消息传递等功能可能会受到严重影响，从而导致损失。</p>
<p>信誉和声誉受损：服务停顿可能会损害组织的声誉和信誉，客户和用户对于系统的可靠性和稳定性会产生负面印象。</p>
<p>综上所述，服务停顿会对用户和业务产生负面影响，需要采取措施来最大程度地减少停顿的发生，并确保系统在出现问题时能够快速恢复。对于像 Redis 这样的关键服务，避免在生产环境中使用可能导致停顿的操作是至关重要的。</p>
<h2 id="2-持久化命令bgsave"><a href="#2-持久化命令bgsave" class="headerlink" title="2.持久化命令bgsave"></a>2.持久化命令bgsave</h2><blockquote>
<p>推荐使用bgsave命令</p>
<p>执行bgsave持久化时，服务会自动创建一个子进程提供bgsave运行，主进程服务负责接收其他的请</p>
</blockquote>
<p><strong>工作原理</strong></p>
<p>具体流程如下：</p>
<p>1.redis客户端执行bgsave命令或者自动触发bgsave命令； </p>
<p>2.主进程判断当前是否已经存在正在执行的子进程，如果存在，那么主进程直接返回； </p>
<p>3.如果不存在正在执行的子进程，那么就fork一个新的子进程进行持久化数据，fork过程是阻塞的，fork操作完成后主进程即可执行其他操作；</p>
<p>4.子进程先将数据写入到临时的rdb文件中，待快照数据写入完成后再原子替换旧的rdb文件；</p>
<p>5.同时发送信号给主进程，通知主进程rdb持久化完成，主进程更新相关的统计信息（info Persitence下的rdb_*相关选项，可在redis内查看持久化结果）。</p>
<h2 id="2-手动触发RDB"><a href="#2-手动触发RDB" class="headerlink" title="2.手动触发RDB"></a>2.手动触发RDB</h2><blockquote>
<p>通过手动RDB，理解数据如何持久化保存即可，通常通过触发特定条件使用自动持久化</p>
</blockquote>
<p><strong>模拟不进行持久化服务重启后会数据丢失</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#数据准备</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name zhao</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1 zhao1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name2 zhao2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#模拟重启丢失</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#systemctl restart redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#redis<span class="operator">-</span>cli</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> name</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<p><strong>手动bgsave触发RDB持久化</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>原数据</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> name</span><br><span class="line">&quot;zhao&quot;</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>修改配置文件添加dir参数指定生成的数据文件存放位置</span><br><span class="line">cat  <span class="operator">&gt;</span><span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>conf<span class="operator">/</span>redis_6379.conf <span class="operator">&lt;&lt;</span><span class="string">&#x27;EOF&#x27;</span> </span><br><span class="line">daemonize yes</span><br><span class="line">bind      <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line">port      <span class="number">6379</span></span><br><span class="line">pidfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>pid<span class="operator">/</span>redis_6379.pid</span><br><span class="line">logfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>logs<span class="operator">/</span>redis_6379.log</span><br><span class="line">dir       <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span>  #注意权限</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>修改后重启redis执行bgsave</span><br><span class="line">systemctl restart  redis</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> bgsave</span><br><span class="line">Background saving started  #后台保存已经开始</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>查看RDB持久化保存的数据</span><br><span class="line">#配置文件不指定文件名，默认以dump.rdb保存，恢复时名字也需要为默认名，否则无法恢复</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#ls <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span>  <span class="operator">-</span>l</span><br><span class="line">total <span class="number">4</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 147 Jun 30 14:57 dump.rdb</span></span><br><span class="line">#存储的数据都为二进制</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#cat <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span>dump.rdb </span><br><span class="line">REDIS0009	redis<span class="operator">-</span>ver5<span class="number">.0</span><span class="number">.7</span></span><br><span class="line">redis<span class="operator">-</span>bits󿿀򳨭eÍused<span class="operator">-</span>memèo	</span><br><span class="line">                                𮤭preamble<span class="operator">~</span>󭠭e2zhao3name1zhao1name3zhao3namezhaoÿ­Yr822</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>重启查看数据</span><br><span class="line">#数据并无丢失，当服务重启后默认会加载持久化生成的数据文件</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#systemctl restart redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#redis<span class="operator">-</span>cli</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> name</span><br><span class="line">&quot;zhao&quot;</span><br></pre></td></tr></table></figure>

<h2 id="3-自动触发RDB"><a href="#3-自动触发RDB" class="headerlink" title="3.自动触发RDB"></a>3.自动触发RDB</h2><blockquote>
<p>根据配置文件中定义的特定条件（savepoint保存点），达到时自动触发bgsave命令，进行RDB持久化</p>
</blockquote>
<p><strong>自动触发配置参数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">save <span class="operator">&lt;</span>seconds<span class="operator">&gt;</span> <span class="operator">&lt;</span>changes<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line">#示例配置</span><br><span class="line">save <span class="number">900</span> <span class="number">1</span>    #数据在<span class="number">900</span>s内发生<span class="number">1</span>次数据变化触发bgsave命令，对当时的数据进行快照二进制数据保存</span><br><span class="line">save <span class="number">300</span> <span class="number">10</span>   #数据在<span class="number">300</span>s内发生<span class="number">10</span>次数据变化触发bgsave命令</span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span> #数据在<span class="number">60</span>s内发生<span class="number">10000</span>次数据变化触发bgsave命令</span><br></pre></td></tr></table></figure>

<p><strong>什么场景会自动触发RDB</strong></p>
<p>1.配置文件中定义的特定条件，savepoint保存点（时间间隔与修改次数，多长时间内发生多少次修改触发）</p>
<p>2.主从复制时，slave节点要从master节点进行全量复制时也会触发bgsave操作，生成当时的快照发送到从节点</p>
<p>3.执行debug reload命令重新加载服务时也会触发bgsave操作</p>
<p>4.默认情况下执行shutdown命令时，如果没有开启aof持久化，那么也会触发bgsave操作</p>
<p><strong>其他相关配置参数</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>dbfilename</td>
<td>RDB生成的数据文件名<br />&#x3D;&#x3D;推荐开启&#x3D;&#x3D;</td>
</tr>
<tr>
<td>dir</td>
<td>RDB文件存放目录</td>
</tr>
<tr>
<td>stop-writes-on-bgsave-error</td>
<td>RDB写入文件数据时出现错误时是否停止写入<br />yes停止（保持数据一致性）no不停止（数据一致性会有问题）</td>
</tr>
<tr>
<td>rdbcompression</td>
<td>RDB写入数据时是否对数据压缩<br />优点：数据压缩会减少文件大小节省了磁盘空间<br />缺点：压缩时会通过cpu调用压缩算法进行压缩，当恢复时解压也会占用CPU增加负载<br />&#x3D;&#x3D;推荐开启&#x3D;&#x3D;</td>
</tr>
<tr>
<td>rdbchecksum</td>
<td>RDB加载恢复数据时会检验数据完整性防止篡改损坏<br />RDB持久化保存数据时会在数据中添加校验值恢复时会对叫校验值进行验证<br />&#x3D;&#x3D;推荐开启&#x3D;&#x3D;</td>
</tr>
</tbody></table>
<h2 id="4-RDB自动持久化部署验证数据恢复"><a href="#4-RDB自动持久化部署验证数据恢复" class="headerlink" title="4.RDB自动持久化部署验证数据恢复"></a>4.RDB自动持久化部署验证数据恢复</h2><p><strong>开启RDB修改配置</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#持久化目录创建授权</span><br><span class="line">mkdir <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data</span><br><span class="line">chown redis.redis <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data</span><br><span class="line"></span><br><span class="line">#配置文件</span><br><span class="line">cat <span class="operator">&gt;</span><span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>conf<span class="operator">/</span>redis_6379.conf <span class="operator">&lt;&lt;</span><span class="string">&#x27;EOF&#x27;</span> </span><br><span class="line">daemonize yes</span><br><span class="line">bind      <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line">port      <span class="number">6379</span></span><br><span class="line">pidfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>pid<span class="operator">/</span>redis_6379.pid</span><br><span class="line">logfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>logs<span class="operator">/</span>redis_6379.log</span><br><span class="line"></span><br><span class="line">save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line">dbfilename redis_dump.rdb</span><br><span class="line">dir       <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span></span><br><span class="line">stop<span class="operator">-</span>writes<span class="operator">-</span><span class="keyword">on</span><span class="operator">-</span>bgsave<span class="operator">-</span>error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#修改后重启</span><br><span class="line">systemctl restart redis</span><br><span class="line">netstat <span class="operator">-</span>tunlp</span><br></pre></td></tr></table></figure>

<p><strong>模拟自动触发环境</strong></p>
<blockquote>
<p>批量写入数据，模拟配置中的保存条件被触发，进行bgsave持久化保存数据</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#保存条件</span><br><span class="line">save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#多进程写入数据，模拟触发保存条件</span><br><span class="line"><span class="keyword">for</span>((i<span class="operator">=</span><span class="number">1</span>;i<span class="operator">&lt;=</span><span class="number">10086</span>;i<span class="operator">+</span><span class="operator">+</span>));do</span><br><span class="line">echo $i</span><br><span class="line">redis<span class="operator">-</span>cli  <span class="keyword">set</span>  这是第$i条数据 这条数据的内容为$i </span><br><span class="line">done;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查数据写入</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">10086</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查保存的RDB数据文件</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll <span class="operator">-</span>h</span><br><span class="line">total <span class="number">524</span>K</span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 521K Jun 30 16:43 redis_dump.rdb</span></span><br></pre></td></tr></table></figure>

<p><strong>测试数据恢复</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#将原数据RDB文件移到其他目录，待会模拟故障防止覆盖</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll <span class="operator">-</span>h</span><br><span class="line">total <span class="number">524</span>K</span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 521K Jun 30 16:43 redis_dump.rdb</span></span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#mv  redis_dump.rdb  <span class="operator">/</span>root<span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#模拟故障，关闭redis服务，内存数据自动丢失</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl stop redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll</span><br><span class="line">total <span class="number">4</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 92 Jun 30 17:33 redis_dump.rdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删除新生成RDB文件，将保存的原数据RDB文件移到数据目录</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#rm <span class="operator">-</span>rf redis_dump.rdb </span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#mv <span class="operator">/</span>root<span class="operator">/</span>redis_dump.rdb  .</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll <span class="operator">-</span>h</span><br><span class="line">total <span class="number">524</span>K</span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 root root 521K Jun 30 17:26 redis_dump.rdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重新启动redis，会自动加载数据目录下的RDB文件，进行数据恢复</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl <span class="keyword">start</span> redis</span><br><span class="line">#检查数据恢复，数据恢复成功</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">10086</span></span><br></pre></td></tr></table></figure>

<h2 id="5-核心"><a href="#5-核心" class="headerlink" title="5.核心"></a>5.核心</h2><p><strong>没配置save参数</strong></p>
<p>shutdown&#x2F;kill&#x2F;pkill关闭服务，都不会持久化数据，只能通过手动bgsave进行持久化</p>
<p><strong>配置了save参数</strong></p>
<p>shutdown&#x2F;kill&#x2F;pkill,关闭服务都会自动触发RDB持久化</p>
<p>pkill -9关闭服务不会触发RDB持久化</p>
<p><strong>关于恢复</strong></p>
<p>RDB持久化的文件名，要和配置文件里一致，否则不识别</p>
<p>RDB备份恢复，都只有一个rdb文件</p>
<p><strong>关于版本</strong></p>
<p>3.x &gt; 5.x  向上兼容没问题</p>
<p>5.x &gt; 3.x  向下兼容不行</p>
<h2 id="6-RDB优缺点总结"><a href="#6-RDB优缺点总结" class="headerlink" title="6.RDB优缺点总结"></a>6.RDB优缺点总结</h2><ul>
<li>优点<ul>
<li>RDB文件是某个时间节点的快照，默认使用LZF算法进行压缩，压缩后的文件体积远远小于内存大小，适用于备份、全量复制等场景；</li>
<li>Redis加载RDB文件恢复数据要远远快于AOF方式；</li>
</ul>
</li>
<li>缺点<ul>
<li>RDB方式实时性不够，无法做到秒级的持久化；</li>
<li>每次调用bgsave都需要fork子进程，fork子进程属于重量级操作，若是频繁执行成本较高；</li>
<li>RDB文件是二进制的，没有可读性，AOF文件在了解其结构的情况下可以手动修改或者补全；</li>
<li>版本兼容RDB文件问题；</li>
</ul>
</li>
</ul>
<p>针对RDB不适合实时持久化的问题，Redis提供了AOF持久化方式来解决</p>
<h1 id="AOF数据持久化实战"><a href="#AOF数据持久化实战" class="headerlink" title="AOF数据持久化实战"></a>AOF数据持久化实战</h1><blockquote>
<p>AOF持久化是将写的请求每一条命令存到AOF文件中，采用写后日志记录，先进行命令执行再记录日志</p>
<p>工作原理：</p>
<p>1.AOF将每一条命令先存储到缓冲区，再进行写入磁盘中，最终将记录保存到AOF文件</p>
<p>2.AOF会通过刷写策略将缓冲区的命令记录写入磁盘，刷写策略是对数据一致性的一个保障机制</p>
</blockquote>
<p><img src="/image-20240701143608185.png" alt="image-20240701143608185"></p>
<h2 id="1-AOF工作原理"><a href="#1-AOF工作原理" class="headerlink" title="1.AOF工作原理"></a>1.AOF工作原理</h2><p><strong>AOF介绍</strong></p>
<p>AOF（Append-Only File）持久化是Redis数据库的一种持久化机制，&#x3D;&#x3D;是一种写后日志的持久化方式&#x3D;&#x3D;</p>
<p>用于将Redis数据集的写操作命令以追加的方式记录到一个文件中。AOF持久化可以确保在Redis重启时能够恢复数据，重启后服务自动加载AOF文件，从而提高数据的持久性和可靠性。</p>
<p><strong>为什么采用写后日志</strong></p>
<p>Redis要求高性能，采用写日志有两方面好处：</p>
<ul>
<li>避免额外的检查开销：Redis在向AOF文件里面记录日志的时候，并不会先去对这些命令进行语法检查。所以，如果先记日志再执行命令的话，不对命令进行检查，日志中就有可能记录了错误的命令，在使用日志恢复数据时，就可能会出错。</li>
<li>不会阻塞服务的其他请求</li>
</ul>
<p>但这种方式存在潜在风险：</p>
<ul>
<li>如果命令执行完成，写日志之前宕机了，会丢失数据。</li>
<li>主线程写磁盘压力大，导致写盘慢，阻塞后续操作。</li>
</ul>
<p><strong>工作原理</strong></p>
<ol>
<li>先执行命令：当Redis服务接收到一个写入类命令，该命令会先会在服务中执行运行写入数据。</li>
<li>写入缓冲区：命令执行后，文本形式的命令会被转换成RESP协议格式并写入AOF缓冲区。。</li>
<li>AOF文件刷写：缓冲区记录的命令，根据配置中定义的刷写策略将命令刷写到AOF文件中。</li>
<li>后台进行刷写：刷写时，redis服务会创建子线程提供AOF持久化写入，防止主进程堵塞</li>
<li>AOF文件的重写和压缩：为了避免AOF文件过大，可以通过配置定义的重写条件对AOF文件定期进行重写和压缩，以减少文件大小并提高性能。</li>
</ol>
<p>总的来说，AOF持久化通过追加记录所有写命令的方式，实现了数据的持久化和恢复。它的工作原理简单高效，能够保证数据的完整性和可靠性。</p>
<p><strong>刷写策略</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>机制</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>always</td>
<td>每个命令执行完毕，立即同步写入日志到磁盘</td>
<td>可靠性强，数据基本不丢</td>
<td>每个命令都要写入日志磁盘，redis性能影响很大</td>
</tr>
<tr>
<td>everysec</td>
<td>每个命令执行完毕，日志只会写入AOF文件的内存缓冲区，每隔一秒把缓冲区的日志写入到磁盘</td>
<td>性能和安全性平滑</td>
<td>宕机会丢失1秒内的数据</td>
</tr>
<tr>
<td>no</td>
<td>每个命令写完，日志只写入AOF文件的内存缓冲区，操作系统自由调度，持久化到磁盘</td>
<td>性能足够好</td>
<td>宕机时，不确定丢失的数据</td>
</tr>
</tbody></table>
<ol>
<li>always：每次有写操作发生时都会进行AOF文件的写入，确保了每个写操作都被持久化，数据完整性得到了保障。但是频繁地进行AOF文件写入可能会影响磁盘IO性能。</li>
<li>everysec：每秒执行一次AOF文件写入操作，可以在一定程度上保证数据的持久性，降低了写入时的性能开销。但是在一秒内发生故障时可能会丢失最后一秒的写操作。</li>
<li>no：完全依赖操作系统的缓存机制，写入性能最高，但持久性最差，数据容易丢失，随机时间刷写数据，无法确定丢失了多少数据。</li>
</ol>
<p><strong>磁盘频繁读写会导致什么？</strong>会导致磁盘的性能降低</p>
<ol>
<li>系统响应变慢：频繁的磁盘写入会占用大量的磁盘I&#x2F;O资源，导致系统磁盘IO相关的响应速度变慢，造成用户体验下降。应用程序可能会出现延迟，响应时间变长。</li>
<li>数据丢失：如果磁盘I&#x2F;O性能受影响导致无法及时将数据写入磁盘，可能会导致数据丢失或损坏。这可能会造成数据不一致或丢失部分重要数据。</li>
<li>系统不稳定：磁盘I&#x2F;O性能受影响可能会导致系统不稳定，甚至系统崩溃。如果系统无法及时处理磁盘I&#x2F;O请求，可能会导致系统挂起或出现其他严重故障。</li>
<li>其他应用程序性能下降：在共享服务器上运行时，磁盘I&#x2F;O性能受影响可能会影响其他应用程序的性能。由于磁盘I&#x2F;O资源被大量占用，其他应用程序对磁盘的访问可能会变得缓慢，导致它们的性能下降。</li>
<li>系统资源耗尽：频繁的磁盘I&#x2F;O操作可能会消耗大量的系统资源，如CPU和内存。这可能会导致系统资源耗尽，影响系统的正常运行。</li>
</ol>
<h2 id="2-AOF参数说明"><a href="#2-AOF参数说明" class="headerlink" title="2.AOF参数说明"></a>2.AOF参数说明</h2><blockquote>
<p>默认redis是没有开AOF功能，修改配置文件添加AOF参数即可</p>
</blockquote>
<p><strong>参数说明</strong></p>
<ol>
<li><strong>appendfsync</strong>: 这个参数指定了在执行 AOF（Append-Only File）持久化时的策略。它有三个可能的取值：<ul>
<li><strong>always</strong>: 在每次事件循环结束时都会执行 <code>fsync</code> 操作，将缓冲区的数据刷写到磁盘，以确保数据的完整性和持久化。</li>
<li><strong>everysec</strong>: 每秒执行一次 <code>fsync</code> 操作，将缓冲区的数据刷写到磁盘。这种设置在性能和数据安全之间做了折中。</li>
<li><strong>no</strong>: 完全依赖操作系统的文件系统来决定何时刷写数据到磁盘。</li>
</ul>
</li>
<li><strong>no-appendfsync-on-rewrite</strong>: 当 AOF 文件因为重写而增长时，如果这个选项被设置为 <code>yes</code>，Redis 将不会执行任何 <code>fsync</code> 操作。这可以提高性能，但增加了数据丢失的风险。</li>
<li><strong>auto-aof-rewrite-percentage</strong> 和 <strong>auto-aof-rewrite-min-size</strong>: 这两个参数用于配置自动触发 AOF 文件重写的条件。<code>auto-aof-rewrite-percentage</code> 表示 AOF 文件当前大小相对于上次重写后的大小的百分比增长，达到该百分比时触发重写。<code>auto-aof-rewrite-min-size</code> 则指定 AOF 文件的最小大小，不管百分比，只要文件大小达到这个值就会触发重写。</li>
<li><strong>aof-load-truncated</strong>: 如果 AOF 文件在写入过程中被意外截断，这个参数可以设置为 <code>yes</code> 来强制 Redis 尝试加载尽可能多的有效数据。</li>
<li><strong>aof-rewrite-incremental-fsync</strong>: 当执行 AOF 重写时，这个参数控制是否增量地执行 <code>fsync</code> 操作。设置为 <code>yes</code> 可以减少磁盘 I&#x2F;O 的峰值负载，但可能会降低持久化的实时性。</li>
</ol>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>appendonly   （yes&#x2F;no）</td>
<td>AOF持久化是否开启</td>
</tr>
<tr>
<td>appendfilename</td>
<td>AOF文件名</td>
</tr>
<tr>
<td>dir</td>
<td>AOF文件存放路径</td>
</tr>
<tr>
<td>appendfsync  （always&#x2F;everysec&#x2F;no）</td>
<td>AOF持久化fsync刷写策略选择</td>
</tr>
<tr>
<td>no-appendfsync-on-rewrite  （yes&#x2F;no）</td>
<td>AOF重写期间是否执行fsync操作</td>
</tr>
<tr>
<td>auto-aof-rewrite-percentage （100）</td>
<td>AOF重写自动触发的条件，和下面min-size结合</td>
</tr>
<tr>
<td>auto-aof-rewrite-min-size   （64mb）</td>
<td>AOF重写自动触发的条件，根据文件大小的阈值触发</td>
</tr>
<tr>
<td>aof-load-truncated        （yes&#x2F;no）</td>
<td>服务故障AOF数据丢失重启服务后是否加载丢失的数据</td>
</tr>
<tr>
<td>aof-rewrite-incremental-fsync （yes&#x2F;no）</td>
<td>AOF重写期间中是否进行增量fsync操作<br />本质上和no-appendfsync-on-rewrite一样</td>
</tr>
</tbody></table>
<h2 id="3-AOF持久化部署验证数据恢复"><a href="#3-AOF持久化部署验证数据恢复" class="headerlink" title="3.AOF持久化部署验证数据恢复"></a>3.AOF持久化部署验证数据恢复</h2><p><strong>开启AOF修改配置</strong></p>
<blockquote>
<p>配置文件添加AOF相关参数即可，先关闭RDB参数，因为要测试AOF数据恢复</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="operator">&gt;</span><span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>conf<span class="operator">/</span>redis_6379.conf <span class="operator">&lt;&lt;</span>&quot;EOF&quot;</span><br><span class="line">daemonize yes</span><br><span class="line">bind      <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line">port      <span class="number">6379</span></span><br><span class="line">pidfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>pid<span class="operator">/</span>redis_6379.pid</span><br><span class="line">logfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>logs<span class="operator">/</span>redis_6379.log</span><br><span class="line">dir       <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span></span><br><span class="line"></span><br><span class="line">#save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">#save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">#save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line">#dbfilename redis_dump.rdb</span><br><span class="line">#stop<span class="operator">-</span>writes<span class="operator">-</span><span class="keyword">on</span><span class="operator">-</span>bgsave<span class="operator">-</span>error yes</span><br><span class="line">#rdbcompression yes</span><br><span class="line">#rdbchecksum yes</span><br><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;redis_appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重启redis</span><br><span class="line">systemctl restart redis</span><br><span class="line">netstat <span class="operator">-</span>tunlp</span><br></pre></td></tr></table></figure>

<p><strong>查看生成的AOF日志文件</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#ls <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span> <span class="operator">-</span>l</span><br><span class="line">total <span class="number">4</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis  0 Jul  1 11:28 redis_appendonly.aof</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#写入数据查看AOF日志记录</span><br><span class="line">redis<span class="operator">-</span>cli <span class="keyword">set</span> name zhao</span><br><span class="line">redis<span class="operator">-</span>cli <span class="keyword">set</span> name1 zhao1</span><br><span class="line">redis<span class="operator">-</span>cli <span class="keyword">set</span> name2 zhao2</span><br><span class="line">redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看AOF日志记录</span><br><span class="line">head  <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span>redis_appendonly.aof </span><br><span class="line"><span class="operator">*</span><span class="number">2</span></span><br><span class="line">$<span class="number">6</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">$<span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="operator">*</span><span class="number">3</span></span><br><span class="line">$<span class="number">3</span></span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">$<span class="number">4</span></span><br><span class="line">name</span><br><span class="line">$<span class="number">4</span></span><br><span class="line">zhao</span><br></pre></td></tr></table></figure>

<p><strong>模拟服务故障数据丢失，基于AOF持久化自动恢复数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#将原AOF文件移走，模拟故障数据丢失</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">~</span>]#cd  <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span></span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll</span><br><span class="line">total <span class="number">4</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 126 Jul  1 11:31 redis_appendonly.aof</span></span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#mv redis_appendonly.aof <span class="operator">/</span>root<span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重启后，服务内存数据自动丢失</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl restart redis</span><br><span class="line">root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将原数据AOF日志文件移回来，重启服务后会自动加载AOF日志内记录，进行恢复数据</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl stop redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#mv <span class="operator">/</span>root<span class="operator">/</span>redis_appendonly.aof  .</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll</span><br><span class="line">total <span class="number">4</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 126 Jul  1 11:51 redis_appendonly.aof</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重启后查看数据恢复</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl <span class="keyword">start</span> redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">3</span></span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli <span class="keyword">get</span> name</span><br><span class="line">&quot;zhao&quot;</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli <span class="keyword">get</span> name1</span><br><span class="line">&quot;zhao1&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>至此，基于AOF持久化恢复数据实战完成</p>
<p>服务故障后，内存存储的数据就会丢失，但是配置了AOF持久化，再次启动服务后，会自动加载AOF日志文件，进行恢复数据</p>
</blockquote>
<h1 id="redis混合持久化实战（主流）"><a href="#redis混合持久化实战（主流）" class="headerlink" title="redis混合持久化实战（主流）"></a>redis混合持久化实战（主流）</h1><p>官网：<a target="_blank" rel="noopener" href="https://redis.io/docs/manual/persistence/">https://redis.io/docs/manual/persistence/</a></p>
<blockquote>
<p>4.0后最新的混合持久化方案</p>
<p>1.触发AOF的重写机制</p>
<p>2.RDB持久化对当前redis服务进行快照保存，保存到临时文件</p>
<p>3.生成新的AOF文件，重写时RDB的临时数据写入AOF内，重写时接收到的命令还是以AOF格式写入新文件底端</p>
<p>4.之后的接收到的新写命令依然已AOF格式继续追加到新AOF文件中</p>
<p>5.等待下次的重写机制触发，进行数据转换格式结合存储</p>
<p>&#x3D;&#x3D;好处是减少持久化文件大小，恢复时速度快，数据持久化更加安全，结合了RDB与AOF的优点&#x3D;&#x3D;</p>
</blockquote>
<h2 id="1-工作原理"><a href="#1-工作原理" class="headerlink" title="1.工作原理"></a>1.工作原理</h2><ol>
<li><strong>触发AOF重写</strong>：<ul>
<li>AOF重写可的持久化和恢复效率。</li>
</ul>
</li>
</ol>
<h2 id="2-开启混合持久化"><a href="#2-开启混合持久化" class="headerlink" title="2.开启混合持久化"></a>2.开启混合持久化</h2><blockquote>
<p>配置文件添加参数 <code>aof-use-rdb-preamble yes</code></p>
<p>5.0之后版本默认开启，但是配置中还是加上开启参数</p>
</blockquote>
<p><strong>配置文件添加参数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#配置参数如下</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>conf]#cat redis_6379.conf </span><br><span class="line">daemonize yes</span><br><span class="line">bind      <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">172.16</span><span class="number">.1</span><span class="number">.51</span></span><br><span class="line">port      <span class="number">6379</span></span><br><span class="line">pidfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>pid<span class="operator">/</span>redis_6379.pid</span><br><span class="line">logfile   <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>logs<span class="operator">/</span>redis_6379.log</span><br><span class="line"></span><br><span class="line">dir       <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data<span class="operator">/</span></span><br><span class="line"></span><br><span class="line">#save <span class="number">900</span> <span class="number">1</span></span><br><span class="line">#save <span class="number">300</span> <span class="number">10</span></span><br><span class="line">#save <span class="number">60</span> <span class="number">10000</span></span><br><span class="line">#dbfilename redis_dump.rdb</span><br><span class="line">#stop<span class="operator">-</span>writes<span class="operator">-</span><span class="keyword">on</span><span class="operator">-</span>bgsave<span class="operator">-</span>error yes</span><br><span class="line">#rdbcompression yes</span><br><span class="line">#rdbchecksum yes</span><br><span class="line"></span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;redis_appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line">aof<span class="operator">-</span>use<span class="operator">-</span>rdb<span class="operator">-</span>preamble yes </span><br></pre></td></tr></table></figure>

<p><strong>重启服务</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart redis</span><br><span class="line">ss <span class="operator">-</span>tunlp</span><br></pre></td></tr></table></figure>

<h2 id="3-手动触发AOF重写混合持久化"><a href="#3-手动触发AOF重写混合持久化" class="headerlink" title="3.手动触发AOF重写混合持久化"></a>3.手动触发AOF重写混合持久化</h2><blockquote>
<p>主动触发重写机制，进行混合持久化，生成新的AOF文件</p>
</blockquote>
<p><strong>测试触发重写机制后AOF文件内原本的RESP记录，转换为了RDB格式的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#环境准备写入数据</span><br><span class="line"><span class="keyword">for</span>((i<span class="operator">=</span><span class="number">1</span>;i<span class="operator">&lt;=</span><span class="number">1000</span>;i<span class="operator">+</span><span class="operator">+</span>));do echo $i;redis<span class="operator">-</span>cli <span class="keyword">set</span> name$i zhao$i; done;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#触发了RDB与AOF持久化</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll</span><br><span class="line">total <span class="number">60</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 38809 Jul  1 16:19 redis_appendonly.aof</span></span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 16884 Jul  1 16:24 redis_dump.rdb</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看AOF生成的数据，都是RESP协议命令记录</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#tail <span class="number">-5</span> redis_appendonly.aof </span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">$<span class="number">8</span></span><br><span class="line">name1000</span><br><span class="line">$<span class="number">8</span></span><br><span class="line">zhao1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#手动触发AOF重写，生成新AOF文件</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> bgrewriteaof</span><br><span class="line">Background append <span class="keyword">only</span> file rewriting started</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查新生成的AOF文件</span><br><span class="line">vim redis_appendonly.aof                   </span><br></pre></td></tr></table></figure>

<ul>
<li>新的AOF文件，重写过后，内部的RESP协议命令记录，都被转换成了RDB二进制格式数据</li>
</ul>
<p><img src="/image-20240701163215056.png" alt="image-20240701163215056"></p>
<p><strong>测试新写入的命令继续以RESP格式追加写入到AOF文件中</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#写入新数据</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1001 wang</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1002 wang1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1003 wang1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1004 wang1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> name1005 wang6</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看的AOF文件新的命令写入</span><br><span class="line">#新的命令以RESP协议追加到了AOF文件的末尾</span><br><span class="line">vim redis_appendonly.aof <span class="operator">/</span> G</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#tail <span class="number">-5</span> redis_appendonly.aof </span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">$<span class="number">8</span></span><br><span class="line">name1005</span><br><span class="line">$<span class="number">5</span></span><br><span class="line">wang6</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结：</p>
<p>当触发了重写机制后，AOF文件内的RESP格式命令记录会被转换为RDB格式的数据存储</p>
<p>而新的命令依旧以RESP格式追加到AOF文件末尾，直到下次触发重写机制，再继续对AOF文件内的数据进行转换</p>
<p>原理看上方工作原理篇即可透彻明白</p>
</blockquote>
<p><strong>混合持久化数据恢复测试</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#当前数据<span class="number">1005</span>条</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1005</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#拷贝已备份数据的AOF混合持久化文件</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#cp redis_appendonly.aof <span class="operator">/</span>root<span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#关闭服务删除持久化文件，模拟服务故障数据丢失</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl stop redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#rm <span class="operator">-</span>f <span class="operator">*</span></span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll</span><br><span class="line">total <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#再次启动，数据为空</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl <span class="keyword">start</span> redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#将备份数据的AOF混合持久化文件移回数据目录</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#cp <span class="operator">/</span>root<span class="operator">/</span>redis_appendonly.aof .</span><br><span class="line">cp: overwrite ‘.<span class="operator">/</span>redis_appendonly.aof’? y</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#ll <span class="operator">-</span>h</span><br><span class="line">total <span class="number">20</span>K</span><br><span class="line"><span class="operator">-</span>rw<span class="operator">-</span>r<span class="comment">--r--. 1 redis redis 17K Jul  1 16:58 redis_appendonly.aof</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重启redis，自动加载混合持久化文件，最终恢复数据</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#systemctl restart redis</span><br><span class="line">[root<span class="variable">@db</span><span class="number">-51</span> <span class="operator">/</span>app<span class="operator">/</span>redis<span class="operator">/</span>redis_6379<span class="operator">/</span>data]#redis<span class="operator">-</span>cli dbsize</span><br><span class="line">(<span class="type">integer</span>) <span class="number">1005</span></span><br></pre></td></tr></table></figure>

<h2 id="4-混合持久化数据恢复加载流程"><a href="#4-混合持久化数据恢复加载流程" class="headerlink" title="4.混合持久化数据恢复加载流程"></a>4.混合持久化数据恢复加载流程</h2><p>混合持久化的加载流程如下：</p>
<blockquote>
<ol>
<li>判断是否开启AOF持久化，开启继续执行后续流程，未开启执行加载RDB文件的流程；</li>
<li>判断AOF文件是否存在，文件存在则执行后续流程；</li>
<li>判断AOF文件开头是RDB的格式, 先加载RDB内容再加载剩余的AOF内容；</li>
<li>判断AOF文件开头不是RDB的格式，直接以AOF格式加载整个文件。</li>
</ol>
</blockquote>
<p><img src="/image-20240701165040760.png" alt="image-20240701165040760"></p>
<h2 id="5-混合持久化优缺点"><a href="#5-混合持久化优缺点" class="headerlink" title="5.混合持久化优缺点"></a>5.混合持久化优缺点</h2><p><strong>混合持久化优点：</strong></p>
<p>混合持久化结合了RDB和AOF持久化的优点，开头为RDB的格式，使得Redis可以更快的启动，同时结合AOF的优点，减低了大量数据丢失的风险。</p>
<p><strong>混合持久化缺点：</strong></p>
<p>AOF文件中添加了RDB格式的内容，使得AOF文件的可读性变得很差；<br>兼容性差，如果开启混合持久化，那么此混合持久化AOF文件，就不能用在Redis4.0之前版本了。（因为该功能是4.0版本之后的）</p>
<h2 id="6-数据持久化建议"><a href="#6-数据持久化建议" class="headerlink" title="6.数据持久化建议"></a>6.数据持久化建议</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://redis.io/topics/persistence</span><br><span class="line">官网给了建议</span><br></pre></td></tr></table></figure>

<p>持久化虽然保证了数据不丢失，但同时拖慢了 Redis 的运行速度，那怎么更合理的使用 Redis 的持久化功能呢？ Redis 持久化的最佳实践可从以下几个方面考虑。</p>
<p><strong>1）控制持久化开关</strong></p>
<p>使用者可根据实际的业务情况考虑，如果对数据的丢失不敏感的情况下，可考虑关闭 Redis 的持久化，这样所以的键值操作都在内存中，就可以保证最高效率的运行 Redis 了。 持久化关闭操作：</p>
<ul>
<li>关闭 RDB 持久化，使用命令： <code>config set save &quot;&quot;</code></li>
<li>关闭 AOF 和 混合持久化，使用命令： <code>config set appendonly no</code></li>
</ul>
<p><strong>2）主从部署</strong></p>
<p>使用主从部署，一台用于响应主业务，一台用于数据持久化，这样就可能让 Redis 更加高效的运行。</p>
<p><strong>3）使用混合持久化</strong></p>
<p>混合持久化结合了 RDB 和 AOF 的优点，Redis 5.0 默认是开启的。</p>
<p><strong>4）使用配置更高的机器</strong></p>
<p>Redis 对 CPU 的要求并不高，反而是对内存和磁盘的要求很高，因为 Redis 大部分时候都在做读写操作，使用更多的内存和更快的磁盘，对 Redis 性能的提高非常有帮助。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">赵东兴</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/">http://example.com/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="数据库Redis-主从复制"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">数据库Redis-主从复制</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="数据库Redis-数据类型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">数据库Redis-数据类型</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">赵东兴</div><div class="author-info__description">个人技术笔记博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">redis数据持久化概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">1.为什么需要持久化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%BC%9A%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1"><span class="toc-number">1.2.</span> <span class="toc-text">2.什么情况会数据丢失</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-number">1.3.</span> <span class="toc-text">3.数据持久化方案</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RDB%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%9E%E6%88%98"><span class="toc-number">2.</span> <span class="toc-text">RDB数据持久化实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8C%81%E4%B9%85%E5%8C%96%E5%91%BD%E4%BB%A4save"><span class="toc-number">2.1.</span> <span class="toc-text">1.持久化命令save</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8C%81%E4%B9%85%E5%8C%96%E5%91%BD%E4%BB%A4bgsave"><span class="toc-number">2.2.</span> <span class="toc-text">2.持久化命令bgsave</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91RDB"><span class="toc-number">2.3.</span> <span class="toc-text">2.手动触发RDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91RDB"><span class="toc-number">2.4.</span> <span class="toc-text">3.自动触发RDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-RDB%E8%87%AA%E5%8A%A8%E6%8C%81%E4%B9%85%E5%8C%96%E9%83%A8%E7%BD%B2%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="toc-number">2.5.</span> <span class="toc-text">4.RDB自动持久化部署验证数据恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%A0%B8%E5%BF%83"><span class="toc-number">2.6.</span> <span class="toc-text">5.核心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-RDB%E4%BC%98%E7%BC%BA%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">2.7.</span> <span class="toc-text">6.RDB优缺点总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOF%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%9E%E6%88%98"><span class="toc-number">3.</span> <span class="toc-text">AOF数据持久化实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-AOF%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">1.AOF工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-AOF%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">3.2.</span> <span class="toc-text">2.AOF参数说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-AOF%E6%8C%81%E4%B9%85%E5%8C%96%E9%83%A8%E7%BD%B2%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="toc-number">3.3.</span> <span class="toc-text">3.AOF持久化部署验证数据恢复</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%BB%E6%B5%81%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">redis混合持久化实战（主流）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">1.工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%BC%80%E5%90%AF%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">4.2.</span> <span class="toc-text">2.开启混合持久化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91AOF%E9%87%8D%E5%86%99%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text">3.手动触发AOF重写混合持久化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">4.混合持久化数据恢复加载流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%B7%B7%E5%90%88%E6%8C%81%E4%B9%85%E5%8C%96%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">4.5.</span> <span class="toc-text">5.混合持久化优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.6.</span> <span class="toc-text">6.数据持久化建议</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%9C%8D%E5%8A%A1%E4%BC%98%E5%8C%96/" title="数据库Redis-服务优化">数据库Redis-服务优化</a><time datetime="2024-08-20T03:44:08.000Z" title="Created 2024-08-20 11:44:08">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E5%88%86%E5%B8%83%E9%9B%86%E7%BE%A4/" title="数据库Redis-分布集群">数据库Redis-分布集群</a><time datetime="2024-08-20T03:43:56.000Z" title="Created 2024-08-20 11:43:56">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E5%93%A8%E5%85%B5%E5%8A%9F%E8%83%BD/" title="数据库Redis-哨兵功能">数据库Redis-哨兵功能</a><time datetime="2024-08-20T03:43:39.000Z" title="Created 2024-08-20 11:43:39">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" title="数据库Redis-主从复制">数据库Redis-主从复制</a><time datetime="2024-08-20T03:43:24.000Z" title="Created 2024-08-20 11:43:24">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E6%95%B0%E6%8D%AE%E5%BA%93Redis-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85/" title="数据库Redis-数据持久">数据库Redis-数据持久</a><time datetime="2024-08-20T03:43:10.000Z" title="Created 2024-08-20 11:43:10">2024-08-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 赵东兴</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>