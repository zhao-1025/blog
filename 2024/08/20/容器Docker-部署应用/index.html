<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>容器Docker-部署应用 | 一往无前虎山行,拨开云雾见光明</title><meta name="author" content="赵东兴"><meta name="copyright" content="赵东兴"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="容器启动link链接作用docker run 命令是 Docker 中用于创建并运行新容器的核心命令之一。--link 参数在 Docker 的早期版本中非常常见，用于容器间的网络连接，使得一个容器可以通过别名（alias）访问另一个容器的 IP 地址、端口等信息，而无需暴露这些容器到宿主机的网络或配置复杂的网络桥接。 然而，需要注意的是，随着 Docker 网络功能的不断完善和 Docker C">
<meta property="og:type" content="article">
<meta property="og:title" content="容器Docker-部署应用">
<meta property="og:url" content="http://example.com/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="一往无前虎山行,拨开云雾见光明">
<meta property="og:description" content="容器启动link链接作用docker run 命令是 Docker 中用于创建并运行新容器的核心命令之一。--link 参数在 Docker 的早期版本中非常常见，用于容器间的网络连接，使得一个容器可以通过别名（alias）访问另一个容器的 IP 地址、端口等信息，而无需暴露这些容器到宿主机的网络或配置复杂的网络桥接。 然而，需要注意的是，随着 Docker 网络功能的不断完善和 Docker C">
<meta property="og:locale">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2024-08-20T01:31:48.000Z">
<meta property="article:modified_time" content="2024-08-20T03:14:00.797Z">
<meta property="article:author" content="赵东兴">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '容器Docker-部署应用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-20 11:14:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="一往无前虎山行,拨开云雾见光明" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="一往无前虎山行,拨开云雾见光明"><span class="site-name">一往无前虎山行,拨开云雾见光明</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">容器Docker-部署应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-20T01:31:48.000Z" title="Created 2024-08-20 09:31:48">2024-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-08-20T03:14:00.797Z" title="Updated 2024-08-20 11:14:00">2024-08-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="容器Docker-部署应用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="容器启动link链接作用"><a href="#容器启动link链接作用" class="headerlink" title="容器启动link链接作用"></a>容器启动link链接作用</h1><p><code>docker run</code> 命令是 Docker 中用于创建并运行新容器的核心命令之一。<code>--link</code> 参数在 Docker 的早期版本中非常常见，用于容器间的网络连接，使得一个容器可以通过别名（alias）访问另一个容器的 IP 地址、端口等信息，而无需暴露这些容器到宿主机的网络或配置复杂的网络桥接。</p>
<p>然而，需要注意的是，随着 Docker 网络功能的不断完善和 Docker Compose 等工具的兴起，<code>--link</code> 参数的使用已经逐渐被更现代、更灵活的网络解决方案所取代。Docker 官方文档也推荐使用自定义网络（如 bridge、overlay 等）来实现容器间的通信，因为这种方法更加灵活且易于管理。</p>
<h2 id="1-–link-参数的作用"><a href="#1-–link-参数的作用" class="headerlink" title="1.–link 参数的作用"></a>1.–link 参数的作用</h2><p>当使用 <code>--link</code> 参数时，Docker 会自动执行以下操作：</p>
<ol>
<li><strong>更新环境变量</strong>：Docker 会在目标容器（即 <code>docker run</code> 命令中未使用 <code>--link</code> 的那个容器）中设置一些环境变量，这些环境变量包含了源容器（即 <code>--link</code> 后指定的容器）的网络信息，如 IP 地址、端口号等。环境变量的命名格式为 <code>&lt;别名&gt;_PORT_&lt;端口号&gt;_&lt;协议&gt;</code>，例如 <code>webdb_PORT_3306_TCP</code>。</li>
<li><strong>添加 <code>/etc/hosts</code> 条目</strong>：Docker 还会在目标容器的 <code>/etc/hosts</code> 文件中添加一个条目，使得目标容器可以通过源容器的别名来解析其 IP 地址。</li>
</ol>
<h2 id="2-不推荐使用-–link"><a href="#2-不推荐使用-–link" class="headerlink" title="2.不推荐使用 –link&#x3D;"></a>2.不推荐使用 –link&#x3D;</h2><p>尽管 <code>--link</code> 提供了一种简单的容器间通信方式，但它有几个缺点：</p>
<ol>
<li><strong>不够灵活</strong>：<code>--link</code> 依赖于硬编码的容器名称和端口，这限制了容器的可移植性和可扩展性。</li>
<li><strong>环境变量污染</strong>：自动设置的环境变量可能会与容器内部已有的环境变量冲突。</li>
<li><strong>不再被推荐</strong>：Docker 官方文档建议使用自定义网络来实现容器间的通信，这种方法更加灵活、安全且易于管理。</li>
</ol>
<h2 id="3-推荐使用自定义网络进行容器间通信"><a href="#3-推荐使用自定义网络进行容器间通信" class="headerlink" title="3.推荐使用自定义网络进行容器间通信"></a>3.推荐使用自定义网络进行容器间通信</h2><p>Docker 提供了多种网络模式，包括 bridge、host、overlay 等。其中，bridge 网络是 Docker 默认的网络类型，适用于单个 Docker 主机上的容器间通信。你可以通过 <code>docker network create</code> 命令创建一个自定义的 bridge 网络，并在运行容器时使用 <code>--network</code> 参数将其连接到该网络。这样，同一网络下的容器就可以通过容器名相互访问了。</p>
<p>​                                                                                                          </p>
<h1 id="容器化部署迁移"><a href="#容器化部署迁移" class="headerlink" title="容器化部署迁移"></a>容器化部署迁移</h1><h2 id="1-容器化迁移好处"><a href="#1-容器化迁移好处" class="headerlink" title="1.容器化迁移好处"></a>1.容器化迁移好处</h2><ol>
<li><strong>提高资源利用率</strong>：<ul>
<li>容器化技术基于宿主机内核运行，没有额外的操作系统开销，使得在相同硬件资源上能够运行更多的容器，从而提高了资源利用率。</li>
</ul>
</li>
<li><strong>快速部署与迁移</strong>：<ul>
<li>容器化技术提供了应用的打包和迁移能力，使得企业可以方便地将应用部署到不同环境，包括开发、测试和生产环境，极大地提高了应用的灵活性。</li>
</ul>
</li>
<li><strong>环境一致性</strong>：<ul>
<li>容器化技术通过将应用程序及其依赖项封装在一个轻量级的容器中，确保了应用在不同环境中运行的一致性，减少了因环境差异导致的问题。</li>
</ul>
</li>
<li><strong>隔离性</strong>：<ul>
<li>容器化技术实现了应用之间的隔离，确保应用运行过程中不会互相干扰，提高了系统的安全性和稳定性。</li>
</ul>
</li>
<li><strong>细粒度弹性与可扩展性</strong>：<ul>
<li>容器化技术允许独立部署高可用组件，消除单点故障，并通过细粒度动态扩展来最大化组件&#x2F;资源密度，以充分利用基础设施资源。</li>
</ul>
</li>
<li><strong>操作一致性</strong>：<ul>
<li>容器化技术简化了异构组件的同构管理，减少了操作环境所需的技能范围，降低了管理复杂度。</li>
</ul>
</li>
<li><strong>组件可移植性</strong>：<ul>
<li>容器化技术使得应用能够跨节点、跨环境、跨云进行移植，确保了在不同平台上的选择性和灵活性。</li>
</ul>
</li>
<li><strong>自动化与持续集成&#x2F;持续部署（CI&#x2F;CD）</strong>：<ul>
<li>容器化技术与自动化工具（如Jenkins）结合，可以实现持续集成和持续部署，极大地提高了开发效率，并简化了版本更新和回滚流程。</li>
</ul>
</li>
<li><strong>标准化迁移方式</strong>：<ul>
<li>容器化迁移基于镜像和容器统一发布，确保了在不同物理服务器上的运行环境无差异，降低了迁移成本。</li>
</ul>
</li>
<li><strong>打通开发与运维桥梁</strong>：<ul>
<li>容器化技术有助于打通开发工程师与运维工程师之间的消息传递桥梁，促进了团队协作和效率提升。</li>
</ul>
</li>
</ol>
<h2 id="2-为什么要容器化迁移"><a href="#2-为什么要容器化迁移" class="headerlink" title="2.为什么要容器化迁移"></a>2.为什么要容器化迁移</h2><ol>
<li><strong>满足快速迭代的市场需求</strong>：<ul>
<li>随着移动互联网行业的快速发展，产品需求快速迭代，容器化迁移能够帮助企业快速响应市场变化，提高产品更新频率。</li>
</ul>
</li>
<li><strong>提升开发效率</strong>：<ul>
<li>容器化迁移简化了应用的部署和迁移流程，减少了开发和测试过程中的环境配置问题，提高了开发效率。</li>
</ul>
</li>
<li><strong>增强系统稳定性与安全性</strong>：<ul>
<li>容器化技术的隔离性和细粒度管理特性有助于提升系统的稳定性和安全性，降低故障风险。</li>
</ul>
</li>
<li><strong>降低成本</strong>：<ul>
<li>容器化迁移通过提高资源利用率和简化管理复杂度，有助于降低企业的IT运营成本。</li>
</ul>
</li>
</ol>
<p>综上所述，容器化迁移是现代企业提升应用部署效率、增强系统稳定性和安全性、降低运营成本的重要手段之一。随着技术的不断发展，容器化迁移将在更多领域发挥重要作用。</p>
<p>​            </p>
<h1 id="容器化部署wordpress"><a href="#容器化部署wordpress" class="headerlink" title="容器化部署wordpress"></a>容器化部署wordpress</h1><h2 id="1-任务目标最终架构"><a href="#1-任务目标最终架构" class="headerlink" title="1.任务目标最终架构"></a>1.任务目标最终架构</h2><p>容器化部署架构下，宿主机的namespace安装 nginx提供LB功能，以及iptables实现数据包转发，以及提供服务器防护；</p>
<p>nginx的LB也就是网关的功能，所有的服务需要经过nginx允许后，才能进入后续的容器；</p>
<p>nginx需要配置反向代理，以及对http信息的校验，也会加入https的安全通信。</p>
<p>以此架构实现一个安全的容器化应用环境。</p>
<blockquote>
<p>nginx提供网关功能，针对client请求信息，进行七层lb负载均衡流量转发</p>
</blockquote>
<p><img src="/image-20240731113009477.png" alt="image-20240731113009477">                                      </p>
<h2 id="2-数据库容器部署"><a href="#2-数据库容器部署" class="headerlink" title="2.数据库容器部署"></a>2.数据库容器部署</h2><p><strong>准备容器内mysql挂载的宿主机数据卷存放目录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /web-wordpress-container/mysql/&#123;conf,data,files&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据卷内映射的mysql配置文件</strong></p>
<p>字符集与字符排序设置是为了wordpress应用导入中文数据按中文编码存储</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>conf]#vim my.conf </span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>conf]#cat my.conf </span><br><span class="line">[mysqld]</span><br><span class="line">port<span class="operator">=</span><span class="number">3306</span></span><br><span class="line"><span class="keyword">user</span><span class="operator">=</span>mysql</span><br><span class="line">datadir<span class="operator">=</span><span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql</span><br><span class="line">socket<span class="operator">=</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.sock</span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span><span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">=</span>utf8mb4</span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span><span class="keyword">collation</span><span class="operator">-</span>server<span class="operator">=</span>utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket<span class="operator">=</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.sock</span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span><span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">=</span>utf8mb4</span><br><span class="line"><span class="keyword">default</span><span class="operator">-</span><span class="keyword">collation</span><span class="operator">-</span>server<span class="operator">=</span>utf8mb4_general_ci</span><br></pre></td></tr></table></figure>

<p><strong>运行mysql容器</strong></p>
<p>这里有个关于<code>mysql-files</code>报错坑，必须配置给挂载一个数据卷目录，要不就一直无法启动</p>
<p><img src="/image-20240731142108738.png" alt="image-20240731142108738"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#运行mysql容器，<span class="comment">--restart=always容器中断后自动重启</span></span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker run  \</span><br><span class="line"><span class="comment">--name wordpress-mysql --restart=always \</span></span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span> \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>conf<span class="operator">/</span>:<span class="operator">/</span>etc<span class="operator">/</span>mysql<span class="operator">/</span> \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>files<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files \</span><br><span class="line"><span class="operator">-</span>e MYSQL_ROOT_PASSWORD<span class="operator">=</span>&quot;1&quot;  \</span><br><span class="line"><span class="operator">-</span>e MYSQL_USER<span class="operator">=</span><span class="string">&#x27;wordpress&#x27;</span> \</span><br><span class="line"><span class="operator">-</span>e MYSQL_PASSWORD<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> \</span><br><span class="line"><span class="operator">-</span>e MYSQL_DATABASE<span class="operator">=</span><span class="string">&#x27;wordpress&#x27;</span> \</span><br><span class="line"><span class="operator">-</span>d mysql:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#可选参数</span><br><span class="line">#可以基于变量传入创建库用户及密码</span><br><span class="line">MYSQL_USER<span class="operator">=</span><span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">MYSQL_PASSWORD<span class="operator">=</span><span class="string">&#x27;1&#x27;</span></span><br><span class="line">MYSQL_DATABASE<span class="operator">=</span><span class="string">&#x27;wordpress&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>检查，容器内mysql服务是否正常运行，可接收外部请求</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#容器进程运行正常</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                 NAMES</span><br><span class="line"><span class="number">6770158</span>eb0f7   mysql:latest   &quot;docker-entrypoint.s…&quot;   <span class="number">12</span> minutes ago   Up <span class="number">17</span> seconds   <span class="number">3306</span><span class="operator">/</span>tcp, <span class="number">33060</span><span class="operator">/</span>tcp   wordpress<span class="operator">-</span>mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#容器的网络空间ip地址</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> ]#docker inspect <span class="number">677</span><span class="operator">|</span>grep <span class="operator">-</span>i ipaddress</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: <span class="keyword">null</span>,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">#mysql服务请求接收正常</span><br><span class="line">root<span class="variable">@6770158eb0f7</span>:<span class="operator">/</span># mysql <span class="operator">-</span>uroot <span class="operator">-</span>p <span class="operator">-</span>h <span class="number">172.17</span><span class="number">.0</span><span class="number">.3</span> <span class="operator">-</span>P3306</span><br><span class="line">Enter password: </span><br><span class="line">mysql<span class="operator">&gt;</span> </span><br></pre></td></tr></table></figure>

<h2 id="3-管理工具容器部署"><a href="#3-管理工具容器部署" class="headerlink" title="3.管理工具容器部署"></a>3.管理工具容器部署</h2><p>仓库基于该工具的使用说明：<a target="_blank" rel="noopener" href="https://hub.docker.com/_/phpmyadmin">https://hub.docker.com/_/phpmyadmin</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#仓库下载phpmyadmin镜像</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">search</span> phpmyadmin</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL</span><br><span class="line">phpmyadmin                        phpMyAdmin <span class="operator">-</span> A web interface <span class="keyword">for</span> MySQL <span class="keyword">and</span> M…   <span class="number">1011</span>      [OK]                                    <span class="number">0</span>         </span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker pull phpmyadmin</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker images</span><br><span class="line">REPOSITORY   TAG        IMAGE ID       CREATED       SIZE</span><br><span class="line">phpmyadmin   latest     e0c502901f60   <span class="number">2</span> years ago   <span class="number">529</span>MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#运行容器，运行phpmyadmin时需要指定mysql的主机名或者ip地址</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker run  <span class="comment">--restart=always  --link wordpress-mysql --name wordpress-phpadmin -d -e PMA_HOST=wordpress-mysql phpmyadmin</span></span><br><span class="line">d412f806a02d22fa3f1a5639ebdb0f98735f8bca667954a87a7bb8927b7c82f6</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                 NAMES</span><br><span class="line">d412f806a02d   phpmyadmin     &quot;/docker-entrypoint.…&quot;   <span class="number">4</span> seconds ago    Up <span class="number">2</span> seconds    <span class="number">80</span><span class="operator">/</span>tcp                wordpress<span class="operator">-</span>phpadmin</span><br><span class="line"><span class="number">6770158</span>eb0f7   mysql:latest   &quot;docker-entrypoint.s…&quot;   <span class="number">43</span> minutes ago   Up <span class="number">31</span> minutes   <span class="number">3306</span><span class="operator">/</span>tcp, <span class="number">33060</span><span class="operator">/</span>tcp   wordpress<span class="operator">-</span>mysql</span><br></pre></td></tr></table></figure>

<h2 id="4-博客应用容器部署"><a href="#4-博客应用容器部署" class="headerlink" title="4.博客应用容器部署"></a>4.博客应用容器部署</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#下载镜像</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">search</span> wordpress</span><br><span class="line">NAME                                      DESCRIPTION                                     STARS     OFFICIAL</span><br><span class="line">wordpress                                 The WordPress rich content management <span class="keyword">system</span>…   <span class="number">5620</span>      [OK]</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker pull wordpress</span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">default</span> tag: latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建宿主机数据卷挂载目录</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>wordpress]#pwd</span><br><span class="line"><span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>wordpress</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#运行容器，数据卷挂载到容器中的代码资源目录，链接数据库容器</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker run <span class="operator">-</span>d <span class="comment">--restart=always --name web-wordpress -v /web-wordpress-container/wordpress/:/var/www/html/ --link=wordpress-mysql wordpress</span></span><br><span class="line">f15e9fa70d0700289674494302c87ee5f156a170dac810471d2d7a9ba63a0043</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS             PORTS                 NAMES</span><br><span class="line">f15e9fa70d07   wordpress      &quot;docker-entrypoint.s…&quot;   <span class="number">6</span> seconds ago       Up <span class="number">4</span> seconds       <span class="number">80</span><span class="operator">/</span>tcp                web<span class="operator">-</span>wordpress</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查数据卷挂载情况</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>web<span class="operator">-</span>wordpress<span class="operator">-</span>container<span class="operator">/</span>wordpress]#ls</span><br><span class="line">index.php    wp<span class="operator">-</span>activate.php     wp<span class="operator">-</span>comments<span class="operator">-</span>post.php  wp<span class="operator">-</span>content   wp<span class="operator">-</span>links<span class="operator">-</span>opml.php  wp<span class="operator">-</span>mail.php      wp<span class="operator">-</span>trackback.php</span><br><span class="line">license.txt  wp<span class="operator">-</span>admin            wp<span class="operator">-</span>config<span class="operator">-</span>docker.php  wp<span class="operator">-</span>cron.php  wp<span class="operator">-</span>load.php        wp<span class="operator">-</span>settings.php  xmlrpc.php</span><br><span class="line">readme.html  wp<span class="operator">-</span>blog<span class="operator">-</span>header.php  wp<span class="operator">-</span>config<span class="operator">-</span>sample.php  wp<span class="operator">-</span>includes  wp<span class="operator">-</span>login.php       wp<span class="operator">-</span>signup.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#容器内服务进程，运行了apache也是web服务器，内置了php模块直接处理了代码，所以不显示php进程</span><br><span class="line">root<span class="variable">@f15e9fa70d07</span>:<span class="operator">/</span>etc<span class="operator">/</span>apache2# ps <span class="operator">-</span>ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          <span class="type">TIME</span> CMD</span><br><span class="line">root          <span class="number">1</span>      <span class="number">0</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">www<span class="operator">-</span>data     <span class="number">25</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">www<span class="operator">-</span>data     <span class="number">26</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">www<span class="operator">-</span>data     <span class="number">27</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">www<span class="operator">-</span>data     <span class="number">28</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">www<span class="operator">-</span>data     <span class="number">29</span>      <span class="number">1</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">26</span> ?        <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> apache2 <span class="operator">-</span>DFOREGROUND</span><br><span class="line">root         <span class="number">30</span>      <span class="number">0</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">27</span> pts<span class="operator">/</span><span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">/</span>bin<span class="operator">/</span>bash</span><br><span class="line">root         <span class="number">39</span>     <span class="number">30</span>  <span class="number">0</span> <span class="number">07</span>:<span class="number">30</span> pts<span class="operator">/</span><span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> ps <span class="operator">-</span>ef</span><br></pre></td></tr></table></figure>

<p>docker run -d –restart&#x3D;always –name web-wordpress -v &#x2F;web-wordpress-container&#x2F;wordpress&#x2F;code&#x2F;:&#x2F;var&#x2F;www&#x2F;html&#x2F;  wordpress</p>
<h2 id="5-提取所有容器地址"><a href="#5-提取所有容器地址" class="headerlink" title="5.提取所有容器地址"></a>5.提取所有容器地址</h2><p><code>docker inspect</code> 命令是 Docker 提供的一个非常有用的工具，用于获取 Docker 容器的详细信息，包括配置、环境变量、网络设置等。通过 <code>--format</code> 参数，用户可以自定义 <code>docker inspect</code> 命令的输出格式，以便只获取他们感兴趣的特定信息。</p>
<p><code>--format</code> 参数后面跟的是一个 Go 模板字符串，Docker 使用这个模板来格式化输出。这意味着用户可以根据需要，构造复杂的查询来提取容器或镜像的特定信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#查看所有容器的主机名与ip地址</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker inspect <span class="comment">--format=&#x27;&#123;&#123;.Name&#125;&#125;   &#123;&#123;.NetworkSettings.Networks.bridge.IPAddress&#125;&#125;&#x27;  `docker ps -aq`</span></span><br><span class="line"><span class="operator">/</span>web<span class="operator">-</span>wordpress   <span class="number">172.17</span><span class="number">.0</span><span class="number">.4</span></span><br><span class="line"><span class="operator">/</span>wordpress<span class="operator">-</span>phpadmin   <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"><span class="operator">/</span>wordpress<span class="operator">-</span>mysql   <span class="number">172.17</span><span class="number">.0</span><span class="number">.3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看所有端口，wordpress端口<span class="number">80</span>，phpmyadmin端口<span class="number">80</span>，mysql端口<span class="number">3306</span></span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS             PORTS                 NAMES</span><br><span class="line">f15e9fa70d07   wordpress      &quot;docker-entrypoint.s…&quot;   <span class="number">15</span> minutes ago   Up <span class="number">15</span> minutes      <span class="number">80</span><span class="operator">/</span>tcp                web<span class="operator">-</span>wordpress</span><br><span class="line">d412f806a02d   phpmyadmin     &quot;/docker-entrypoint.…&quot;   <span class="number">49</span> minutes ago   Up <span class="number">49</span> minutes      <span class="number">80</span><span class="operator">/</span>tcp                wordpress<span class="operator">-</span>phpadmin</span><br><span class="line"><span class="number">6770158</span>eb0f7   mysql:latest   &quot;docker-entrypoint.s…&quot;   <span class="number">2</span> hours ago      Up About an <span class="keyword">hour</span>   <span class="number">3306</span><span class="operator">/</span>tcp, <span class="number">33060</span><span class="operator">/</span>tcp   wordpress<span class="operator">-</span>mysql</span><br></pre></td></tr></table></figure>

<h2 id="6-宿主机部署web服务器"><a href="#6-宿主机部署web服务器" class="headerlink" title="6.宿主机部署web服务器"></a>6.宿主机部署web服务器</h2><blockquote>
<p>宿主机运行nginx服务，基于反向代理功能，转发请求到容器内服务</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#安装nginx服务</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#yum install nginx <span class="operator">-</span>y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#编辑配置文件，设置url请求转发</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>conf.d]#vim wordpress.conf</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>conf.d]#cat wordpress.conf </span><br><span class="line">#wordpress配置</span><br><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  dongxing.wordpress.com;</span><br><span class="line">    location <span class="operator">/</span></span><br><span class="line">    &#123;</span><br><span class="line">        proxy_pass http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.17</span><span class="number">.0</span><span class="number">.4</span>:<span class="number">80</span><span class="operator">/</span>;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">        proxy_set_header X<span class="operator">-</span>Forwarded<span class="operator">-</span><span class="keyword">For</span> $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_connect_timeout <span class="number">30</span>;</span><br><span class="line">        proxy_send_timeout <span class="number">60</span>;</span><br><span class="line">        proxy_read_timeout <span class="number">60</span>;</span><br><span class="line">        proxy_buffering <span class="keyword">on</span>;</span><br><span class="line">        proxy_buffer_size <span class="number">32</span>k;</span><br><span class="line">        proxy_buffers <span class="number">4</span> <span class="number">128</span>k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#phpadmin配置</span><br><span class="line">    server &#123;</span><br><span class="line">    listen       <span class="number">81</span>;</span><br><span class="line">    server_name  phpmyadmin.wordpress.com;</span><br><span class="line">    location <span class="operator">/</span> &#123;</span><br><span class="line">            proxy_pass http:<span class="operator">/</span><span class="operator">/</span><span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>:<span class="number">80</span><span class="operator">/</span>;</span><br><span class="line">            proxy_set_header Host $http_host;</span><br><span class="line">            proxy_set_header X<span class="operator">-</span>Forwarded<span class="operator">-</span><span class="keyword">For</span> $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_connect_timeout <span class="number">30</span>;</span><br><span class="line">            proxy_send_timeout <span class="number">60</span>;</span><br><span class="line">            proxy_read_timeout <span class="number">60</span>;</span><br><span class="line">            proxy_buffering <span class="keyword">on</span>;</span><br><span class="line">            proxy_buffer_size <span class="number">32</span>k;</span><br><span class="line">            proxy_buffers <span class="number">4</span> <span class="number">128</span>k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#检查配置文件</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>conf.d]#nginx <span class="operator">-</span>t</span><br><span class="line">nginx: the configuration file <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>nginx.conf syntax <span class="keyword">is</span> ok</span><br><span class="line">nginx: configuration file <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>nginx.conf test <span class="keyword">is</span> successful</span><br><span class="line">#重启nginx</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>etc<span class="operator">/</span>nginx<span class="operator">/</span>conf.d]#systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="7-访问web应用"><a href="#7-访问web应用" class="headerlink" title="7.访问web应用"></a>7.访问web应用</h2><p><strong>配置本地hosts解析</strong></p>
<blockquote>
<p>10.0.0.107 dongxing.wordpress.com phpmyadmin.wordpress.com</p>
</blockquote>
<p><strong>访问dongxing.wordpress.com初始化安装wordpress,在mysql容器上创建数据库与链接用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#创建授权</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;wordpress&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> wordpress.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;wordpress&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> database wordpress;</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看创建数据库时使用的<span class="keyword">sql</span>语句</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">create</span> database wordpress;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Database  <span class="operator">|</span> <span class="keyword">Create</span> Database                                                                                                                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> wordpress <span class="operator">|</span> <span class="keyword">CREATE</span> DATABASE `wordpress` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">#查看登录白名单</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="keyword">user</span>,host <span class="keyword">FROM</span> mysql.user;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">user</span>             <span class="operator">|</span> host      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> root             <span class="operator">|</span> <span class="operator">%</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> wordpress        <span class="operator">|</span> <span class="operator">%</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.infoschema <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.session    <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql.sys        <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> root             <span class="operator">|</span> localhost <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+-----------+</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看用户权限</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> grants <span class="keyword">for</span> wordpress@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Grants <span class="keyword">for</span> wordpress@<span class="operator">%</span>                                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">GRANT</span> USAGE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> `wordpress`@`<span class="operator">%</span>`                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> `wordpress`.<span class="operator">*</span> <span class="keyword">TO</span> `wordpress`@`<span class="operator">%</span>` <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>初始化安装好后，登录发表一篇文章</strong></p>
<p><img src="/image-20240731165424911.png" alt="image-20240731165424911"></p>
<h2 id="8-访问web管理工具"><a href="#8-访问web管理工具" class="headerlink" title="8.访问web管理工具"></a>8.访问web管理工具</h2><p>跳过</p>
<h1 id="容器化部署zabbix"><a href="#容器化部署zabbix" class="headerlink" title="容器化部署zabbix"></a>容器化部署zabbix</h1><p>!<img src="/image-20240801155348671.png" alt="image-20240801155348671"></p>
<h2 id="1-数据库容器部署"><a href="#1-数据库容器部署" class="headerlink" title="1.数据库容器部署"></a>1.数据库容器部署</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#准备镜像</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker images<span class="operator">|</span>grep mysql</span><br><span class="line">mysql        latest     <span class="number">3218</span>b38490ce   <span class="number">2</span> years ago   <span class="number">516</span>MB</span><br><span class="line"></span><br><span class="line">#准备宿主机数据卷映射目录</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#mkdir <span class="operator">-</span>p <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>&#123;conf,data,files&#125;</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#cd <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span></span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql]#ls</span><br><span class="line">conf  data  files</span><br><span class="line"></span><br><span class="line">#准备映射容器内的MYSQL配置</span><br><span class="line">cat <span class="operator">&gt;</span> <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>conf<span class="operator">/</span>my.conf <span class="operator">&lt;&lt;</span><span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[mysqld]</span><br><span class="line">port<span class="operator">=</span><span class="number">3306</span></span><br><span class="line"><span class="keyword">user</span><span class="operator">=</span>mysql</span><br><span class="line">datadir<span class="operator">=</span><span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql</span><br><span class="line">socket<span class="operator">=</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.sock</span><br><span class="line"><span class="type">character</span><span class="operator">-</span><span class="keyword">set</span><span class="operator">=</span>utf8mb4</span><br><span class="line"><span class="keyword">collation</span><span class="operator">-</span>server<span class="operator">=</span>utf8mb4_general_ci</span><br><span class="line">[mysql]</span><br><span class="line">socket<span class="operator">=</span><span class="operator">/</span>tmp<span class="operator">/</span>mysql.sock</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">#启动容器，数据卷映射，并传入变量创建zabbix用户</span><br><span class="line">docker run  \</span><br><span class="line"><span class="comment">--name zabbix-mysql --restart=always \</span></span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>data<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span> \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>conf<span class="operator">/</span>:<span class="operator">/</span>etc<span class="operator">/</span>mysql<span class="operator">/</span> \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>zabbix<span class="operator">-</span>container<span class="operator">/</span>mysql<span class="operator">/</span>files<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">-</span>files \</span><br><span class="line"><span class="operator">-</span>e MYSQL_ROOT_PASSWORD<span class="operator">=</span>&quot;1&quot;  \</span><br><span class="line"><span class="operator">-</span>e MYSQL_USER<span class="operator">=</span><span class="string">&#x27;zabbix&#x27;</span> \</span><br><span class="line"><span class="operator">-</span>e MYSQL_PASSWORD<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> \</span><br><span class="line"><span class="operator">-</span>d mysql:latest</span><br><span class="line"></span><br><span class="line">#检查容器进程</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line"><span class="number">5328</span>b4d6a897   mysql:latest   &quot;docker-entrypoint.s…&quot;   <span class="number">4</span> seconds ago   Up <span class="number">2</span> seconds   <span class="number">3306</span><span class="operator">/</span>tcp, <span class="number">33060</span><span class="operator">/</span>tcp   zabbix<span class="operator">-</span>my</span><br><span class="line"></span><br><span class="line">#检查容器运行地址</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker inspect zabbix<span class="operator">-</span>mysql <span class="comment">--format=&#x27;&#123;&#123;.Name&#125;&#125;   &#123;&#123;.NetworkSettings.Networks.bridge.IPAddress&#125;&#125;&#x27;</span></span><br><span class="line"><span class="operator">/</span>zabbix<span class="operator">-</span>mysql   <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line">#进入容器检查数据库运行状态与库创建用户权限信息</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">exec</span> <span class="operator">-</span>it zabbix<span class="operator">-</span>mysql  bash</span><br><span class="line">root<span class="variable">@5328b4d6a897</span>:<span class="operator">/</span># mysql <span class="operator">-</span>uzabbix <span class="operator">-</span>p <span class="operator">-</span>h172<span class="number">.17</span><span class="number">.0</span><span class="number">.2</span></span><br><span class="line">Enter password: </span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> zabbix             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> grants <span class="keyword">for</span> zabbix ;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Grants <span class="keyword">for</span> zabbix@<span class="operator">%</span>                                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">GRANT</span> USAGE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> `zabbix`@`<span class="operator">%</span>`                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> `zabbix`.<span class="operator">*</span> <span class="keyword">TO</span> `zabbix`@`<span class="operator">%</span>` <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="2-服务端容器部署"><a href="#2-服务端容器部署" class="headerlink" title="2.服务端容器部署"></a>2.服务端容器部署</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#镜像准备</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">search</span> zabbix<span class="operator">|</span>grep zabbix  </span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>agent                       Zabbix agent <span class="keyword">with</span> TLS encryption support        <span class="number">230</span>       </span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>web<span class="operator">-</span>nginx<span class="operator">-</span>mysql             Zabbix frontend based <span class="keyword">on</span> Nginx web<span class="operator">-</span>server wi…   <span class="number">256</span>       </span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql                Zabbix Server <span class="keyword">with</span> MySQL database support       <span class="number">413</span>      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#镜像下载</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker pull zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>web<span class="operator">-</span>nginx<span class="operator">-</span>mysql</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker pull zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker images<span class="operator">|</span>grep zabbix</span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>web<span class="operator">-</span>nginx<span class="operator">-</span>mysql   latest     <span class="number">7</span>ce5ac13bc18   <span class="number">2</span> years ago   <span class="number">179</span>MB</span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql      latest     cdd7911de13a   <span class="number">2</span> years ago   <span class="number">67.7</span>MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#容器启动</span><br><span class="line">docker run  \</span><br><span class="line"><span class="comment">--name zabbix-server-mysql \</span></span><br><span class="line"><span class="comment">--link zabbix-mysql \</span></span><br><span class="line"><span class="operator">-</span>e DB_SERVER_HOST<span class="operator">=</span>&quot;zabbix-mysql&quot; \</span><br><span class="line"><span class="operator">-</span>e MYSQL_USER<span class="operator">=</span>&quot;zabbix&quot; \</span><br><span class="line"><span class="operator">-</span>e MYSQL_PASSWORD<span class="operator">=</span>&quot;1&quot; \</span><br><span class="line"><span class="operator">-</span>p <span class="number">10051</span>:<span class="number">10051</span> \</span><br><span class="line"><span class="operator">-</span>d zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查容器进程</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE                        COMMAND                  CREATED          STATUS          PORTS                                           NAMES</span><br><span class="line"><span class="number">22</span>b382ed5fd6   zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql   &quot;/sbin/tini -- /usr/…&quot;   <span class="number">25</span> seconds ago   Up <span class="number">24</span> seconds   <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">10051</span><span class="operator">-</span><span class="operator">&gt;</span><span class="number">10051</span><span class="operator">/</span>tcp, :::<span class="number">10051</span><span class="operator">-</span><span class="operator">&gt;</span><span class="number">10051</span><span class="operator">/</span>tcp   zabbix<span class="operator">-</span>server<span class="operator">-</span>mysql</span><br><span class="line"><span class="number">4759083</span>a4d6e   mysql:latest                 &quot;docker-entrypoint.s…&quot;   <span class="number">8</span> minutes ago    Up <span class="number">8</span> minutes    <span class="number">3306</span><span class="operator">/</span>tcp, <span class="number">33060</span><span class="operator">/</span>tcp                             zabbix<span class="operator">-</span>mysql</span><br></pre></td></tr></table></figure>

<h3 id="2-1-服务端为什么要映射外部端口"><a href="#2-1-服务端为什么要映射外部端口" class="headerlink" title="2.1 服务端为什么要映射外部端口"></a>2.1 服务端为什么要映射外部端口</h3><p>在您的Docker容器配置中，您确实在<code>zabbix-server-mysql</code>容器上使用了<code>-p 10051:10051</code>来映射宿主机端口。这个端口的映射主要用于Zabbix服务器的几个可能的原因，尽管从传统的Web访问角度来看，它可能不是直接必需的，但在Zabbix的架构和操作中，这个端口可能扮演着重要角色。</p>
<h3 id="2-2-Zabbix-Server端口的作用"><a href="#2-2-Zabbix-Server端口的作用" class="headerlink" title="2.2 Zabbix Server端口的作用"></a>2.2 Zabbix Server端口的作用</h3><ol>
<li><strong>Zabbix Server的API和监控接口</strong>：<ul>
<li>Zabbix Server不仅处理与数据库的交互来存储监控数据，还提供了API接口供Zabbix前端（Web界面）、Zabbix Agent以及其他可能的服务使用。端口10051通常是Zabbix Server用于监听这些API请求的标准端口。</li>
<li>尽管Web前端（zabbix-web-nginx-mysql）是用户交互的主要界面，但它依赖于与Zabbix Server的通信来获取数据和发送命令。</li>
</ul>
</li>
<li><strong>直接访问和调试</strong>：<ul>
<li>在某些情况下，直接访问Zabbix Server的端口可以用于调试、监控或直接从命令行工具与Zabbix Server进行交互。</li>
<li>端口映射允许您从宿主机上直接访问这些服务，而无需通过Docker网络进行路由。</li>
</ul>
</li>
<li><strong>分布式部署</strong>：<ul>
<li>在更复杂的Zabbix部署中，可能涉及多个Zabbix Server或代理服务器。端口映射使得这些服务器之间的通信更加灵活和直接。</li>
</ul>
</li>
</ol>
<h3 id="2-3-为什么需要映射端口"><a href="#2-3-为什么需要映射端口" class="headerlink" title="2.3 为什么需要映射端口"></a>2.3 为什么需要映射端口</h3><ul>
<li><strong>网络隔离和安全性</strong>：虽然您可能不需要从外部直接访问Zabbix Server的端口，但在某些安全配置或网络隔离策略下，确保服务在预期的网络边界内是可访问的可能是必要的。</li>
<li><strong>灵活性</strong>：端口映射提供了额外的灵活性，允许您在需要时轻松调整访问控制或测试配置。</li>
</ul>
<h3 id="2-4-结论"><a href="#2-4-结论" class="headerlink" title="2.4 结论"></a>2.4 结论</h3><p>尽管从纯Web访问的角度来看，<code>zabbix-server-mysql</code>容器的端口映射可能不是必需的，但它对于Zabbix的整体运行和可能的未来扩展是有益的。它确保了Zabbix  Server的API和监控接口在需要时是可访问的，并提供了额外的配置和调试选项。如果您的环境不需要这些功能，并且您确信所有必要的通信都可以通过其他方式（如Docker网络）进行，则可以选择不映射该端口。然而，在大多数情况下，保留这些端口映射是更安全和更灵活的选择。</p>
<h2 id="3-web端部署访问"><a href="#3-web端部署访问" class="headerlink" title="3.web端部署访问"></a>3.web端部署访问</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#镜像准备</span><br><span class="line">##zabbix<span class="operator">-</span>ui组件是通过web服务器<span class="operator">+</span>php代码通过服务端及数据库的接口，最终实现web的展示与使用</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker images;</span><br><span class="line">REPOSITORY                      TAG        IMAGE ID       CREATED       SIZE</span><br><span class="line">zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>web<span class="operator">-</span>nginx<span class="operator">-</span>mysql   latest     <span class="number">7</span>ce5ac13bc18   <span class="number">2</span> years ago   <span class="number">179</span>MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#启动容器</span><br><span class="line">docker run \</span><br><span class="line"><span class="comment">--name zabbix-web-nginx-mysql \</span></span><br><span class="line"><span class="comment">--link zabbix-mysql \</span></span><br><span class="line"><span class="comment">--link zabbix-server-mysql \</span></span><br><span class="line"><span class="operator">-</span>e DB_SERVER_HOST<span class="operator">=</span>&quot;zabbix-mysql&quot; \</span><br><span class="line"><span class="operator">-</span>e MYSQL_USER<span class="operator">=</span>&quot;zabbix&quot; \</span><br><span class="line"><span class="operator">-</span>e MYSQL_PASSWORD<span class="operator">=</span>&quot;1&quot; \</span><br><span class="line"><span class="operator">-</span>e ZBX_SERVER_HOST<span class="operator">=</span>&quot;zabbix-server-mysql&quot; \</span><br><span class="line"><span class="operator">-</span>e PHP_TZ<span class="operator">=</span>&quot;Asia/Shanghai&quot; \</span><br><span class="line"><span class="operator">-</span>p <span class="number">80</span>:<span class="number">8080</span> \</span><br><span class="line"><span class="operator">-</span>d zabbix<span class="operator">/</span>zabbix<span class="operator">-</span>web<span class="operator">-</span>nginx<span class="operator">-</span>mysql</span><br></pre></td></tr></table></figure>

<p><strong>测试访问web</strong></p>
<p>默认账户Admin，密码zabbix</p>
<p><img src="/image-20240801180341099.png" alt="image-20240801180341099"></p>
<p><strong>语言转换为中文</strong></p>
<p>转换成中文，就可以下载客户端agent组件进行监控主机了</p>
<p><img src="/image-20240801180824553.png" alt="image-20240801180824553"></p>
<h2 id="4-容器部署zabbix报错"><a href="#4-容器部署zabbix报错" class="headerlink" title="4.容器部署zabbix报错"></a>4.容器部署zabbix报错</h2><p><strong>cannot use database “zabbix”: its “users” table is empty (is this the Zabbix proxy database?)中文：无法使用数据库“zabbix”：其“用户”表为空（这是 Zabbix 代理数据库吗？）</strong></p>
<p><img src="/image-20240801173521988.png" alt="image-20240801173521988"></p>
<p><strong>报错原因：</strong></p>
<blockquote>
<p>数据库中已有zabbix这个库，创建MYSQL容器时指定变量创建了zabbix库</p>
<p>到了zabbix服务端连接数据库时，会创建库并且导入相关数据表，发现无法创建，就报错了</p>
</blockquote>
<p><strong>解决方法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#进入MYSQL容器删除zabbix库即可</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">exec</span> <span class="operator">-</span>it zabbix<span class="operator">-</span>mysql bash</span><br><span class="line">root<span class="variable">@4759083a4d6e</span>:<span class="operator">/</span># mysql <span class="operator">-</span>uzabbix <span class="operator">-</span>p</span><br><span class="line">Enter password: </span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> zabbix             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> database zabbix ;</span><br><span class="line">Query OK, <span class="number">14</span> <span class="keyword">rows</span> affected (<span class="number">0.14</span> sec)</span><br></pre></td></tr></table></figure>



<h1 id="容器化部署jenkins"><a href="#容器化部署jenkins" class="headerlink" title="容器化部署jenkins"></a>容器化部署jenkins</h1><h2 id="1-部署运行容器"><a href="#1-部署运行容器" class="headerlink" title="1.部署运行容器"></a>1.部署运行容器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#镜像准备</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker <span class="keyword">search</span> jenkins</span><br><span class="line">NAME                                  DESCRIPTION                                     STARS     OFFICIAL</span><br><span class="line">jenkins                               DEPRECATED; use &quot;jenkins/jenkins:lts&quot; instead   <span class="number">5694</span>      [OK]</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker pull jenkins </span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker images<span class="operator">|</span>grep jenkins</span><br><span class="line">jenkins                         latest     cd14cecfdb3a   <span class="number">6</span> years ago   <span class="number">696</span>MB</span><br><span class="line"></span><br><span class="line">#宿主机数据卷授权，容器内系统登录的是虚拟用户，所以需要授权</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#useradd <span class="operator">-</span>M <span class="operator">-</span>s <span class="operator">/</span>sbin<span class="operator">/</span>nologin jenkins</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#id jenkins</span><br><span class="line">uid<span class="operator">=</span><span class="number">1000</span>(jenkins) gid<span class="operator">=</span><span class="number">1000</span>(jenkins) <span class="keyword">groups</span><span class="operator">=</span><span class="number">1000</span>(jenkins)</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#mkdir <span class="operator">-</span>p <span class="operator">/</span>jenkins<span class="operator">-</span>container<span class="operator">/</span>jenkins_home</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#chown <span class="operator">-</span>R jenkins.jenkins <span class="operator">/</span>jenkins<span class="operator">-</span>container<span class="operator">/</span>jenkins_home<span class="operator">/</span></span><br><span class="line"></span><br><span class="line">#启动容器</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker run <span class="comment">--name jenkins -p 80:8080 -v /jenkins-container/jenkins_home/:/var/jenkins_home/ -d jenkins</span></span><br><span class="line">bd4007e541a52180478f9d1ecb5bf8d60e560f5dd5f8c178adf65cb0725cae89</span><br><span class="line"></span><br><span class="line">#检查容器进程</span><br><span class="line">[root<span class="variable">@docker</span><span class="number">-01</span> <span class="operator">~</span>]#docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS        PORTS                                              NAMES</span><br><span class="line">bd4007e541a5   jenkins   &quot;/bin/tini -- /usr/l…&quot;   <span class="number">2</span> seconds ago   Up <span class="number">1</span> <span class="keyword">second</span>   <span class="number">50000</span><span class="operator">/</span>tcp, <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">80</span><span class="operator">-</span><span class="operator">&gt;</span><span class="number">8080</span><span class="operator">/</span>tcp, :::<span class="number">80</span><span class="operator">-</span><span class="operator">&gt;</span><span class="number">8080</span><span class="operator">/</span>tcp   jenkins</span><br></pre></td></tr></table></figure>

<h2 id="2-提权运行容器"><a href="#2-提权运行容器" class="headerlink" title="2.提权运行容器"></a>2.提权运行容器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"><span class="comment">--name jenkins \</span></span><br><span class="line"><span class="operator">-</span>p <span class="number">8080</span>:<span class="number">8080</span> <span class="operator">-</span>p <span class="number">50000</span>:<span class="number">50000</span> \</span><br><span class="line"><span class="comment">--privileged=true \</span></span><br><span class="line"><span class="comment">--user root \</span></span><br><span class="line"><span class="operator">-</span>v  <span class="operator">/</span>jenkins_home<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>jenkins_home<span class="operator">/</span> \</span><br><span class="line"><span class="operator">-</span>d  jenkin</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Jenkins作为一个持续集成和持续部署（CI&#x2F;CD）工具，本身并不直接涉及操作系统层面的提权需求。然而，在特定场景下，Jenkins可能会因为执行特定任务或脚本而需要提升权限，这通常是为了能够访问或修改系统上的资源，这些资源可能受到操作系统的权限控制。</p>
</blockquote>
<p>Jenkins需要提权的原因可能包括但不限于以下几点：</p>
<ol>
<li><strong>访问受保护的资源</strong>：Jenkins在构建、测试或部署应用程序时，可能需要访问系统上的敏感文件或目录，如系统配置文件、日志文件等。这些资源可能只有超级用户（root）或具有特定权限的用户才能访问。因此，Jenkins可能需要提升权限以执行这些操作。</li>
<li><strong>执行系统命令</strong>：在某些情况下，Jenkins需要执行系统命令来完成构建或部署过程。如果这些命令需要更高的权限才能执行（例如，安装软件包、修改网络配置等），那么Jenkins就需要相应的权限。</li>
<li><strong>安全性考虑</strong>：虽然提升权限可以带来便利，但也增加了安全风险。如果Jenkins的权限过高，一旦Jenkins系统被攻击或配置不当，攻击者就可能利用这些权限对系统进行更严重的破坏。因此，在提升Jenkins权限时，需要仔细考虑安全性和必要性。</li>
<li><strong>自动化需求</strong>：在自动化构建和部署流程中，Jenkins经常需要执行一系列复杂的任务。这些任务可能涉及多个步骤和多个系统组件的交互。为了确保流程的顺畅进行，Jenkins可能需要提升权限以克服各种权限限制和障碍。</li>
<li><strong>特定场景下的需求</strong>：在某些特定场景下，如部署到生产环境时，Jenkins可能需要执行一些特殊的操作（如重启服务、修改数据库配置等），这些操作通常需要较高的权限。</li>
</ol>
<p>需要注意的是，虽然Jenkins在某些情况下需要提升权限，但并不意味着它应该始终以最高权限运行。相反，为了降低安全风险，建议采用最小权限原则来配置Jenkins的运行权限。同时，也可以通过使用sudo等工具来限制Jenkins在特定命令或脚本上的权限提升行为。</p>
<p>此外，对于Jenkins的提权问题，还需要注意以下几点：</p>
<ul>
<li>确保Jenkins的配置文件（如jenkins.xml）和插件等组件的安全性，避免被恶意修改或利用。</li>
<li>定期检查Jenkins的日志文件和系统日志，以发现潜在的安全问题或异常行为。</li>
<li>对Jenkins的访问权限进行严格控制，避免未经授权的访问和操作。</li>
<li>定期对Jenkins进行更新和维护，以确保其安全性和稳定性。</li>
</ul>
<h2 id="3-调用宿主机命令"><a href="#3-调用宿主机命令" class="headerlink" title="3.调用宿主机命令"></a>3.调用宿主机命令</h2><p><strong>如何在容器化的jenkins里，再执行docker命令？</strong></p>
<p>我们毕竟要基于jenkins去实现对容器的管理，那么jenkins所处的运行环境，也得安装docker命令，或者走http的管理接口更为方便</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"><span class="comment">--name jenkins \</span></span><br><span class="line"><span class="operator">-</span>p <span class="number">8080</span>:<span class="number">8080</span> <span class="operator">-</span>p <span class="number">50000</span>:<span class="number">50000</span> \</span><br><span class="line"><span class="comment">--privileged=true \</span></span><br><span class="line"><span class="comment">--user root \</span></span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>docker:<span class="operator">/</span>usr<span class="operator">/</span>bin<span class="operator">/</span>docker \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>var<span class="operator">/</span>run<span class="operator">/</span>docker.sock:<span class="operator">/</span>var<span class="operator">/</span>run<span class="operator">/</span>docker.sock \</span><br><span class="line"><span class="operator">-</span>v <span class="operator">/</span>jenkins_home<span class="operator">/</span>:<span class="operator">/</span>var<span class="operator">/</span>jenkins_home \</span><br><span class="line"><span class="operator">-</span>d jenkins<span class="operator">/</span>jenkins</span><br></pre></td></tr></table></figure>

<p><img src="/image-20240801192307475.png" alt="image-20240801192307475"></p>
<h2 id="4-疑惑解决"><a href="#4-疑惑解决" class="headerlink" title="4.疑惑解决"></a>4.疑惑解决</h2><h3 id="4-1-容器暴露50000端口原因"><a href="#4-1-容器暴露50000端口原因" class="headerlink" title="4.1 容器暴露50000端口原因"></a>4.1 容器暴露50000端口原因</h3><p>在Docker中运行Jenkins时，通常会暴露两个端口：8080和50000。这两个端口都有特定的用途，对于Jenkins的正常运行至关重要。</p>
<ol>
<li><strong>端口8080</strong>：<ul>
<li>端口8080是Jenkins的Web界面和REST API的默认端口。用户通过浏览器访问这个端口来访问Jenkins的仪表板、管理界面、查看构建历史、触发新的构建等。简而言之，这是用户与Jenkins进行交互的主要方式。</li>
</ul>
</li>
<li><strong>端口50000</strong>：<ul>
<li>端口50000用于Jenkins的分布式构建功能，特别是当Jenkins master需要与Jenkins agent（也称为slave或node）进行通信时。Jenkins的分布式构建允许你在多个机器上并行运行构建任务，以加快构建过程。</li>
<li>当Jenkins master分配一个构建任务给agent时，它们之间会建立一个TCP连接，用于传输构建任务所需的文件、执行构建命令，并收集构建结果。默认情况下，这个连接是通过端口50000建立的。</li>
<li>如果你的Jenkins部署不需要分布式构建功能，理论上你可以不暴露这个端口。然而，保留这个端口对于未来可能需要的扩展性是有好处的。</li>
</ul>
</li>
</ol>
<h3 id="4-2-宿主机创建虚拟用户原因"><a href="#4-2-宿主机创建虚拟用户原因" class="headerlink" title="4.2 宿主机创建虚拟用户原因"></a>4.2 宿主机创建虚拟用户原因</h3><blockquote>
<p>关于用户</p>
</blockquote>
<p><strong>容器内用户</strong>：在Docker容器中，通常会创建一个或多个用户来运行应用服务，这是出于安全考虑。例如，Jenkins容器内部可能有一个<code>jenkins</code>用户来运行Jenkins服务。这个用户是容器内部的用户，与宿主机上的用户没有直接关系。</p>
<p><strong>宿主机用户与容器内用户的关系</strong>：虽然宿主机和容器内的用户不是同一个实体，但你可以通过调整宿主机上文件或目录的权限和所有权，来允许容器内的用户访问这些资源。这是因为Docker容器在宿主机上运行时，会模拟一个文件系统，并通过虚拟层来访问宿主机的实际文件系统。</p>
<blockquote>
<p>关于数据卷和权限</p>
</blockquote>
<p><strong>数据卷</strong>：Docker数据卷是一种特殊的存储机制，允许你将容器内的文件系统路径与宿主机上的文件系统路径进行映射。这样，容器就可以访问和操作宿主机上的文件了。</p>
<p><strong>权限设置</strong>：为了确保容器内的进程（如Jenkins服务）能够正确访问宿主机上的数据卷，你需要在宿主机上调整数据卷目录的权限和所有权。这通常涉及到使用<code>chown</code>和<code>chmod</code>命令来设置正确的用户和组权限。</p>
<p>例如，如果你希望Jenkins容器内的<code>jenkins</code>用户能够访问宿主机上的<code>/www.yuchaoit.cn_data/jenkins/</code>目录，你需要确保这个目录在宿主机上的所有权和权限被设置为允许<code>jenkins</code>用户（或对应的UID和GID）进行读写操作。但是，请注意，这里的<code>jenkins</code>用户并不是宿主机上的实际用户，而是指容器内部使用的用户ID（UID）和组ID（GID）。</p>
<p><strong>UID和GID的映射</strong>：在某些情况下，你可能需要确保容器内的UID和GID与宿主机上的某个用户或组相对应。这通常涉及到Docker的高级配置，如使用<code>--userns</code>选项来配置用户命名空间，但这通常不是必需的，除非你有特定的安全或兼容性需求。</p>
<p>总结来说，虽然你不会在宿主机上直接创建与容器内同名的用户，但你需要通过调整宿主机上文件或目录的权限和所有权来确保容器内的进程能够正确访问这些资源。这是Docker容器化应用时管理权限和文件访问的一种常见做法。</p>
<h1 id="多容器运行工具compose"><a href="#多容器运行工具compose" class="headerlink" title="多容器运行工具compose"></a>多容器运行工具compose</h1><h2 id="1-Docker-Compose概述"><a href="#1-Docker-Compose概述" class="headerlink" title="1.Docker Compose概述"></a>1.Docker Compose概述</h2><p>Docker Compose是一个命令行工具，它用于定义和运行多容器Docker应用程序。通过Compose，开发者可以使用YAML文件（通常是<code>docker-compose.yml</code>）来配置应用程序需要的所有服务。这些服务会作为容器在Docker中运行，并且可以通过Compose命令来管理这些容器的生命周期，如启动、停止和重启。</p>
<h2 id="1-Docker-Compose的主要功能"><a href="#1-Docker-Compose的主要功能" class="headerlink" title="1.Docker Compose的主要功能"></a>1.Docker Compose的主要功能</h2><ol>
<li><strong>服务定义</strong>：通过<code>docker-compose.yml</code>文件，用户可以定义应用程序所需的所有服务（容器），包括它们的配置、网络设置和依赖关系。</li>
<li><strong>一键部署</strong>：使用<code>docker-compose up</code>命令，用户可以一键启动并运行所有在<code>docker-compose.yml</code>文件中定义的服务。</li>
<li><strong>环境隔离</strong>：Compose为每个项目创建一个默认的网络，服务之间可以通过容器名称相互访问，从而实现环境隔离。</li>
<li><strong>依赖管理</strong>：Compose会自动处理容器之间的依赖关系，确保服务按照正确的顺序启动。</li>
<li><strong>配置管理</strong>：用户可以在<code>docker-compose.yml</code>文件中指定环境变量、卷和端口映射等配置，以便在不同环境中轻松部署应用程序。</li>
</ol>
<h2 id="2-语法使用"><a href="#2-语法使用" class="headerlink" title="2.语法使用"></a>2.语法使用</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  gitlab:</span><br><span class="line">    image: <span class="string">&#x27;jenkins/jenkins:latest&#x27;</span></span><br><span class="line">    container_name: jenkins </span><br><span class="line">    restart: always</span><br><span class="line">    privileged: <span class="literal">true</span></span><br><span class="line">    <span class="keyword">user</span>: root</span><br><span class="line">    ports:</span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;8080:8080&#x27;</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;50000:50000&#x27;</span></span><br><span class="line">    volumes:</span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;/data/jenkins:/var/jenkins_home&#x27;</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;/var/run/docker.sock:/var/run/docker.sock&#x27;</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;/usr/bin/docker:/usr/bin/docker&#x27;</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&#x27;/root/.ssh:/root/.ssh&#x27;</span></span><br></pre></td></tr></table></figure>



<h1 id="私有仓库harbor搭建"><a href="#私有仓库harbor搭建" class="headerlink" title="私有仓库harbor搭建"></a>私有仓库harbor搭建</h1><h2 id="1-仓库概述"><a href="#1-仓库概述" class="headerlink" title="1.仓库概述"></a>1.仓库概述</h2><p>Docker Registry有两种形式</p>
<ul>
<li>公开，开放给所有用户，提供给所有用户搜索，拉取，提交，更新镜像，还免费保管用户镜像数据。<ul>
<li>此类服务受限于网络限制，无法及时立即获取所需镜像，简单说就是需要用什么得现下载，得看网速</li>
<li>优点是可以获取绝大部分公开的镜像，方便使用</li>
</ul>
</li>
<li>私有范围的Registry服务，用在学校，企业内网的研发环境<ul>
<li>局域网环境，保证了镜像拉取速度</li>
<li>保证核心镜像数据安全</li>
<li>存在镜像不丰富问题</li>
</ul>
</li>
</ul>
<h2 id="2-公开服务仓库"><a href="#2-公开服务仓库" class="headerlink" title="2.公开服务仓库"></a>2.公开服务仓库</h2><p>最常见的Registry是Docker Hub，也是docker默认允许用户管理镜像的Registry服务，拥有大量高质量的官方镜像。</p>
<p>由于网络地域原因，公开服务在国内访问较慢，也就出现了针对镜像服务的加速器。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://book.bikongge.com/sre/10-%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/docker-all/www.yuchaoit.cn">阿里云加速器</a></li>
<li>DaoCloud加速器</li>
<li>灵雀云加速器</li>
<li>等等</li>
</ul>
<p>使用加速器，可以从国内的地址获取Docker Hub的镜像，速度会快很多。</p>
<h2 id="3-私有服务仓库"><a href="#3-私有服务仓库" class="headerlink" title="3.私有服务仓库"></a>3.私有服务仓库</h2><p>除了私用公开服务外，还可以在自己本地搭建私有Docker Registry。</p>
<p>开源的Docker Registry镜像只提供了Docker Registry API的功能，没有图形化功能。</p>
<h2 id="4-仓库搭建"><a href="#4-仓库搭建" class="headerlink" title="4.仓库搭建"></a>4.仓库搭建</h2><p>暂未记录</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">赵东兴</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/">http://example.com/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92/" title="容器Docker-单机编排"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">容器Docker-单机编排</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/" title="容器Docker-镜像构建"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">容器Docker-镜像构建</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">赵东兴</div><div class="author-info__description">个人技术笔记博客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8link%E9%93%BE%E6%8E%A5%E4%BD%9C%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">容器启动link链接作用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E2%80%93link-%E5%8F%82%E6%95%B0%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1.–link 参数的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%8D%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8-%E2%80%93link"><span class="toc-number">1.2.</span> <span class="toc-text">2.不推荐使用 –link&#x3D;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E8%BF%9B%E8%A1%8C%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.</span> <span class="toc-text">3.推荐使用自定义网络进行容器间通信</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E8%BF%81%E7%A7%BB"><span class="toc-number">2.</span> <span class="toc-text">容器化部署迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%81%E7%A7%BB%E5%A5%BD%E5%A4%84"><span class="toc-number">2.1.</span> <span class="toc-text">1.容器化迁移好处</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%81%E7%A7%BB"><span class="toc-number">2.2.</span> <span class="toc-text">2.为什么要容器化迁移</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2wordpress"><span class="toc-number">3.</span> <span class="toc-text">容器化部署wordpress</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%BB%E5%8A%A1%E7%9B%AE%E6%A0%87%E6%9C%80%E7%BB%88%E6%9E%B6%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">1.任务目标最终架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">3.2.</span> <span class="toc-text">2.数据库容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">3.3.</span> <span class="toc-text">3.管理工具容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8D%9A%E5%AE%A2%E5%BA%94%E7%94%A8%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">3.4.</span> <span class="toc-text">4.博客应用容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%8F%90%E5%8F%96%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.</span> <span class="toc-text">5.提取所有容器地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%BF%E4%B8%BB%E6%9C%BA%E9%83%A8%E7%BD%B2web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.6.</span> <span class="toc-text">6.宿主机部署web服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%AE%BF%E9%97%AEweb%E5%BA%94%E7%94%A8"><span class="toc-number">3.7.</span> <span class="toc-text">7.访问web应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%AE%BF%E9%97%AEweb%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">3.8.</span> <span class="toc-text">8.访问web管理工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2zabbix"><span class="toc-number">4.</span> <span class="toc-text">容器化部署zabbix</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">4.1.</span> <span class="toc-text">1.数据库容器部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">4.2.</span> <span class="toc-text">2.服务端容器部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%98%A0%E5%B0%84%E5%A4%96%E9%83%A8%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.2.1.</span> <span class="toc-text">2.1 服务端为什么要映射外部端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Zabbix-Server%E7%AB%AF%E5%8F%A3%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">2.2 Zabbix Server端口的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%98%A0%E5%B0%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.2.3.</span> <span class="toc-text">2.3 为什么需要映射端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E7%BB%93%E8%AE%BA"><span class="toc-number">4.2.4.</span> <span class="toc-text">2.4 结论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-web%E7%AB%AF%E9%83%A8%E7%BD%B2%E8%AE%BF%E9%97%AE"><span class="toc-number">4.3.</span> <span class="toc-text">3.web端部署访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%B9%E5%99%A8%E9%83%A8%E7%BD%B2zabbix%E6%8A%A5%E9%94%99"><span class="toc-number">4.4.</span> <span class="toc-text">4.容器部署zabbix报错</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2jenkins"><span class="toc-number">5.</span> <span class="toc-text">容器化部署jenkins</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%83%A8%E7%BD%B2%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">5.1.</span> <span class="toc-text">1.部署运行容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8F%90%E6%9D%83%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">2.提权运行容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%B0%83%E7%94%A8%E5%AE%BF%E4%B8%BB%E6%9C%BA%E5%91%BD%E4%BB%A4"><span class="toc-number">5.3.</span> <span class="toc-text">3.调用宿主机命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%96%91%E6%83%91%E8%A7%A3%E5%86%B3"><span class="toc-number">5.4.</span> <span class="toc-text">4.疑惑解决</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%B9%E5%99%A8%E6%9A%B4%E9%9C%B250000%E7%AB%AF%E5%8F%A3%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.4.1.</span> <span class="toc-text">4.1 容器暴露50000端口原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%AE%BF%E4%B8%BB%E6%9C%BA%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.4.2.</span> <span class="toc-text">4.2 宿主机创建虚拟用户原因</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E5%B7%A5%E5%85%B7compose"><span class="toc-number">6.</span> <span class="toc-text">多容器运行工具compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker-Compose%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">1.Docker Compose概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker-Compose%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.</span> <span class="toc-text">1.Docker Compose的主要功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%AD%E6%B3%95%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">2.语法使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93harbor%E6%90%AD%E5%BB%BA"><span class="toc-number">7.</span> <span class="toc-text">私有仓库harbor搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%93%E5%BA%93%E6%A6%82%E8%BF%B0"><span class="toc-number">7.1.</span> <span class="toc-text">1.仓库概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%85%AC%E5%BC%80%E6%9C%8D%E5%8A%A1%E4%BB%93%E5%BA%93"><span class="toc-number">7.2.</span> <span class="toc-text">2.公开服务仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%A7%81%E6%9C%89%E6%9C%8D%E5%8A%A1%E4%BB%93%E5%BA%93"><span class="toc-number">7.3.</span> <span class="toc-text">3.私有服务仓库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA"><span class="toc-number">7.4.</span> <span class="toc-text">4.仓库搭建</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E5%8D%95%E6%9C%BA%E7%BC%96%E6%8E%92/" title="容器Docker-单机编排">容器Docker-单机编排</a><time datetime="2024-08-20T01:32:01.000Z" title="Created 2024-08-20 09:32:01">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/" title="容器Docker-部署应用">容器Docker-部署应用</a><time datetime="2024-08-20T01:31:48.000Z" title="Created 2024-08-20 09:31:48">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA/" title="容器Docker-镜像构建">容器Docker-镜像构建</a><time datetime="2024-08-20T01:31:29.000Z" title="Created 2024-08-20 09:31:29">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E7%BD%91%E7%BB%9C%E5%AD%98%E5%82%A8/" title="容器Docker-网络存储">容器Docker-网络存储</a><time datetime="2024-08-20T01:31:14.000Z" title="Created 2024-08-20 09:31:14">2024-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/20/%E5%AE%B9%E5%99%A8Docker-%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" title="容器Docker-安装部署">容器Docker-安装部署</a><time datetime="2024-08-20T01:31:00.000Z" title="Created 2024-08-20 09:31:00">2024-08-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 赵东兴</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>